'use strict';mix_d("DealsWidgetsCards__deals-hero-shoveler:deals-hero-shoveler__0Y1uQ-0g","exports tslib @p/A @c/metrics @c/aui-utils @c/remote-operations @c/scoped-dom @c/logger @c/navigation".split(" "),function(n,l,J,g,t,K,L,M,N){function q(b){return b&&"object"===typeof b&&"default"in b?b:{"default":b}}var h=q(J),p=q(L),y=q(M),z=q(N),A={},u=function(b,a,d){void 0===a&&(a="");void 0===d&&(d=1);a=b+a;A.hasOwnProperty(a)||(A[a]=!0,g.count(b,(g.count(b)||0)+d))},P=function(b){u(h["default"].capabilities.mobile?
"Card:EERU:SharedLib:mobile:render":"Card:EERU:SharedLib:desktop:render");var a=function(c,e){c={$event:{preventDefault:h["default"].$.noop,stopPropagation:h["default"].$.noop},$target:c.getContent().find('[data-a-tab-name="'+e+'"]'),data:{name:"energyEfficiencyTabSet"}};h["default"].trigger("a:declarative:a-tabs:click",c)},d=function(c,e){var f=c&&c.$event,k=c&&c.data||{},v=k.activeTabName,O=k.modalHeight,B=k.name;f&&f.preventDefault&&f.preventDefault();f&&f.stopPropagation&&f.stopPropagation();
f=e.get(B);f||(h["default"].on("a:popover:beforeShow:"+B,function(m){m.popover&&m.popover.getContent&&(m=m.popover.getContent(),m.find(".a-manually-loaded").parent().css("min-height",O),h["default"].loadDescendantImagesManually(m))}),f=e.create(c.$target,k));f.show();a(f,v)};b.when("a-secondary-view").execute("RegisterEnergyEfficiencyEventMobile",function(c){h["default"].declarative("card-energy-efficiency-secondary-view","click",function(e){u("Card:EERU:SharedLib:mobile:click",e&&e.data&&e.data.name||
"");d(e,c)})});b.when("a-modal").execute("RegisterEnergyEfficiencyEventDesktop",function(c){h["default"].declarative("card-energy-efficiency-modal","click",function(e){u("Card:EERU:SharedLib:desktop:click",e&&e.data&&e.data.name||"");d(e,c)})})},Q=function(b){b.when("ready").execute("EEBadgeProductFicheResize",function(a){var d=h["default"].$;d(".energyEfficiencyContainer").each(function(c,e){c=d(e).find(".energyEfficiencyProductFicheLabel").first();e=d(e).find("svg").first();c.parent().outerHeight()>
e.outerHeight()&&(c.removeClass("a-size-small"),c.addClass("a-size-micro"),c.parent().outerHeight()>e.outerHeight()&&c.parent().css("line-height","10px"))})})},R=function(){var b=window.P;P(b);Q(b)},w=function(b){return{days:Math.floor(b/864E5),hours:Math.floor(b/36E5),minutes:Math.floor(b/6E4%60),seconds:Math.floor(b/1E3%60)}},r=function(b){if(0>=b)return"00:00";var a=w(b);b=a.hours;a=[a.minutes,a.seconds];0<b&&a.unshift(b);return a.map(x).join(":")},x=function(b){return 9<b?String(b):"0"+b},T=function(b){Array.prototype.slice.call(b.getElementsByClassName("badge-countdown-timer")).forEach(function(a){(new S(a)).start()})},
S=function(){function b(a){this.timerElement=a;this.msToEvent=parseInt(a.dataset.targetTime,10);this.timerElement.innerText=r(this.msToEvent)}b.prototype.start=function(){var a=this;isNaN(this.msToEvent)||(this.counterStartTime=Date.now(),this.counterInterval=t.interval(function(){return a.updateTime()},500))};b.prototype.updateTime=function(){var a=Date.now()-this.counterStartTime;0>=this.msToEvent-a&&clearInterval(this.counterInterval);this.timerElement.innerText=r(this.msToEvent-a)};return b}(),
U=function(b){Array.prototype.slice.call(b.getElementsByClassName("_deals-hero-shoveler_style_badgeContainer__1d1AC")).forEach(function(a){var d,c,e,f,k,v=null!==(d=a.dataset.lineheight)&&void 0!==d?d:32;d=(null!==(e=null===(c=null===a||void 0===a?void 0:a.getBoundingClientRect())||void 0===c?void 0:c.height)&&void 0!==e?e:0)>v?"_deals-hero-shoveler_style_badgeTwoLineContainer__h4pBW":"_deals-hero-shoveler_style_badgeOneLineContainer__3rv_g";null===(f=null===a||void 0===a?void 0:a.classList)||void 0===
f?void 0:f.remove("_deals-hero-shoveler_style_badgeLayoutCheck__3QeMG");null===(k=null===a||void 0===a?void 0:a.classList)||void 0===k?void 0:k.add(d)})},W=function(b){return Array.prototype.slice.call(b.getElementsByClassName("claim-information")).map(function(a){return new V(a)})},X=function(b,a){a.forEach(function(d){var c;null===(c=b[d.dealId])||void 0===c?void 0:c.update(d)})},Y=function(b){return b.filter(function(a){return a.isUpdateNecessary()}).reduce(function(a,d){a[d.getDealId()]=d;return a},
{})},V=function(){function b(a){this.dealId=a.dataset.claimDealId;this.pollPeriodMs=parseInt(a.dataset.pollPeriod,10);this.claimBar=Array.prototype.slice.call(a.getElementsByClassName("claim-bar"))[0];this.claimText=Array.prototype.slice.call(a.getElementsByClassName("claim-text"))[0];this.lastUpdated=Date.now()}b.prototype.update=function(a){this.lastUpdated=Date.now();this.claimText.innerText=a.percentClaimed.displayString;this.claimBar.style.width=a.percentClaimed.value+"%";this.pollPeriodMs=a.pollPeriodMs};
b.prototype.isUpdateNecessary=function(){var a=Date.now()-this.lastUpdated;return a>=this.pollPeriodMs||0>a};b.prototype.getDealId=function(){return this.dealId};return b}(),C=function(b,a){return b.replace(/\$\{\s*(.+?)\s*\}/g,function(d,c){return a[c]})},Z=function(b,a){var d=a["deals-ends-in"];b=b.msToEvent;if(0>=b)return d+" 00:00";var c=w(b).days;return 1<c?C(a["deals-ends-in-x-days"],{daysCount:""+c}):d+" "+r(b)},aa=function(b,a){var d=a["deals-start-in"],c=b.msToEvent;if(0>=c)return d+" 00:00";
var e=w(c),f=e.days;if(1>e.hours)return d+" "+r(c);d=a["deals-start-at"];return 1>f?(a=new Date(b.timestamp),b=x(a.getHours()),a=x(a.getMinutes()),d+" "+b+":"+a):1<f?C(a["deals-start-in-x-days"],{daysCount:""+f}):a["deals-start-in-day"]},ca=function(b){var a=ba(b);if(a){var d=Array.prototype.slice.call(b.getElementsByClassName("end-timer-content"));b=Array.prototype.slice.call(b.getElementsByClassName("start-timer-content"));d.forEach(function(c){(new D(c,a,Z)).start()});b.forEach(function(c){(new D(c,
a,aa)).start()})}},D=function(){function b(a,d,c){this.canStart=!1;try{this.timerElement=a,this.time=JSON.parse(a.dataset.targetTime),this.canStart=!0,this.translatedStrings=d,this.customFormatTime=c,this.timerElement.innerText=this.customFormatTime(this.time,this.translatedStrings)}catch(e){y["default"].log("Could not extract targetTime because of parsing error: "+e.message)}}b.prototype.start=function(){var a=this;this.canStart&&(this.counterStartTime=(new Date).getTime(),setInterval(function(){a.updateTime()},
500))};b.prototype.updateTime=function(){var a=(new Date).getTime()-this.counterStartTime;a=this.customFormatTime({msToEvent:this.time.msToEvent-a,timestamp:this.time.timestamp},this.translatedStrings);this.timerElement.innerText=a};return b}(),ba=function(b){b=b.getElementsByClassName("localizedStringsContent")[0].dataset.localizedStrings;try{return JSON.parse(b)}catch(a){y["default"].log("Could not extract localizes strings because of parsing error: "+a.message)}},E=function(){var b=z["default"].getLocation().href;
z["default"].setLocation(b)},G=function(b,a){return l.__awaiter(void 0,void 0,void 0,function(){var d;return l.__generator(this,function(c){switch(c.label){case 0:return[4,F(b,a)];case 1:return d=c.sent(),t.delay(function(){return G(b,d)},d),[2]}})})},F=function(b,a){return l.__awaiter(void 0,void 0,void 0,function(){var d,c,e;return l.__generator(this,function(f){switch(f.label){case 0:d=Y(b.claimBars);if(!(0<Object.keys(d).length))return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,b.operationProxy.getClaimedDealInformation(Object.keys(d))];
case 2:c=f.sent();if(H(c))return 429!==c.status&&503!==c.status||g.count("deals-hero-shoveler-card:dealStatus:aapi:serviceUnavailable",1),404===c.status&&(g.count("deals-hero-shoveler-card:dealStatus:aapi:staleRefresh",1),E()),g.count("deals-hero-shoveler-card:dealStatus:aapi:fetchFailure",1),g.count("deals-hero-shoveler-card:dealStatus:aapi:fetchFailure:"+c.status,1),[2,2*a];X(d,c);return[3,4];case 3:return e=f.sent(),!I(e)||404!==e.statusCode&&403!==e.statusCode||(g.count("deals-hero-shoveler-card:dealStatus:staleRefresh",
1),E()),g.count("deals-hero-shoveler-card:dealStatus:failure",1),g.count("deals-hero-shoveler-card:dealStatus:failure:"+e.statusCode,1),[2,2*a];case 4:return[2,6E3]}})})},H=function(b){return b&&!!b.status},I=function(b){return b&&"AjaxError"===b.type};n._operationNames=["getClaimedDealInformation"];n.card=function(){return l.__awaiter(void 0,void 0,void 0,function(){var b,a;return l.__generator(this,function(d){R();U(p["default"].cardRoot);p["default"].cardRoot.classList.remove("_deals-hero-shoveler_style_layoutCheck__3STFA");
b=K.setup();ca(p["default"].cardRoot);T(p["default"].cardRoot);a=W(p["default"].cardRoot);t.delay(function(){return G({claimBars:a,operationProxy:b},6E3)},6E3);return[2]})})};n.isAjaxError=I;n.isRemoteApiError=H;n.refreshDealStatus=F});
