(window.dealsJsonpFunction=window.dealsJsonpFunction||[]).push([["main"],{"/xOi":function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return u}));var n=r("q1tI"),a=r.n(n),i=r("XzT5"),o=r("4l3j"),s=r.n(o);i.a.use(s.a).init({resources:{default:{translation:window.Globals.dealsTranslationStrings}},lng:window.location.search&&window.location.search.indexOf("stringDebug=1")>=0?"cimode":"default",interpolation:{prefix:"${",suffix:"}"}});var c=i.a.t.bind(i.a);function u(e){return a.a.createElement(a.a.Fragment,null,c(e.string_id,e.default,e.params))}},"1fPH":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("SrB9");function a(e){return e===n.a.MOBILE||e===n.a.FIREPHONE?"sp_gb_mshop_mgrid":"sp_gb_main_supple"}},"3w8K":function(e,t,r){"use strict";r.d(t,"o",(function(){return l})),r.d(t,"h",(function(){return d})),r.d(t,"g",(function(){return f})),r.d(t,"i",(function(){return p})),r.d(t,"f",(function(){return g})),r.d(t,"j",(function(){return T})),r.d(t,"k",(function(){return m})),r.d(t,"l",(function(){return E})),r.d(t,"n",(function(){return h})),r.d(t,"m",(function(){return v})),r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return O})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return S})),r.d(t,"e",(function(){return _}));var n=r("mrSG"),a=r("SrB9"),i=r("6soB"),o=r("i7xV");function s(e,t){return window.ue.event(function(e,t){return{widgetType:t.widgetType,pageId:t.pageId,pageType:t.pageType,slotId:t.slotId,sessionId:t.sessionId,dealId:e.deal.dealID,rank:e.deal.dealRank,percentClaimed:e.deal.dealStatus.percentClaimed||null,placementId:t.placementId,marketplaceId:t.marketplaceId}}(e,t),"deals","deal.DealImpressionEvent.2")}function c(e,t){return window.ue.event(function(e,t){return{widgetType:t.widgetType,pageId:t.pageId,pageType:t.pageType,slotId:t.slotId,sessionId:t.sessionId,dealId:e.dealID,rank:e.dealRank,percentClaimed:e.percentClaimed||null,placementId:t.placementId,marketplaceId:t.marketplaceId}}(e,t),"deals","deal.DealInteractionEvent.2")}var u=r("aE9G"),l=function(e,t,r){return{type:R,serviceContext:e,widgetConfiguration:t,slotId:r}};function d(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(t){switch(t.label){case 0:return[4,a.logFatal(e)];case 1:return t.sent(),[2]}}))}))}}function f(e,t){return function(r,a,i){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(r){switch(r.label){case 0:return[4,i.logError(e,t)];case 1:return r.sent(),[2]}}))}))}}function p(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(t){switch(t.label){case 0:return[4,a.logOverflowError(e)];case 1:return t.sent(),[2]}}))}))}}function g(){return function(e,t,r){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(e){switch(e.label){case 0:return[4,r.initOverflowMetric()];case 1:return e.sent(),[2]}}))}))}}function T(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,s(e,r().events)];case 1:return n.sent(),Object(i.e)("deals:postDealImpressionEventToCsm:success",1),[3,3];case 2:return t=n.sent(),a.logError({exception:t,message:"Can't record deal impression event "+e}),Object(i.e)("deals:postDealImpressionEventToCsm:error",1),[3,3];case 3:return[2]}}))}))}}function m(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.d)(this,(function(n){switch(n.label){case 0:switch(n.trys.push([0,6,,7]),e.source){case o.c.ADD_TO_CART:case o.c.WATCH:case o.c.UNWATCH:case o.c.COLLECT_VOUCHERS:case o.c.WAIT_LIST:return[3,1];case o.c.IMG:case o.c.VIEW_ALL_ITEMS:case o.c.SIGN_UP_FOR_PRIME:case o.c.LEARN_MORE:case o.c.VIEW_DETAILS:case o.c.VIEW_OPTIONS:case o.c.STAR_RATING:case o.c.TITLE:return[3,3]}return[3,5];case 1:return[4,Promise.all([c(e,r().events),a.refTagService.recordDealInteractionRefTag(e,r().events)])];case 2:return n.sent(),[3,5];case 3:return[4,c(e,r().events)];case 4:n.sent(),n.label=5;case 5:return Object(i.e)("deals:"+r().events.deviceType+":"+r().events.widgetType+":postDealInteraction",1),[3,7];case 6:return t=n.sent(),Object(u.e)(t)?t instanceof u.b&&a.logError({message:"Can't post deal interaction event to server dummy endpoint "+e,exception:t}):a.logError({exception:t,message:"Can't record deal interaction event "+e}),[3,7];case 7:return[2]}}))}))}}function E(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,a.refTagService.postFilterInteractionToRefTagService(e,r().events)];case 1:return n.sent(),Object(i.e)("deals:"+r().events.deviceType+":"+r().events.widgetType+":postFilterInteraction",1),[3,3];case 2:return t=n.sent(),Object(u.e)(t)?t instanceof u.b&&a.logError({message:"Can't post filter interaction event to server dummy endpoint "+e,exception:t}):a.logError({exception:t,message:"Fail during a translation of filter interaction event "+e}),[3,3];case 3:return[2]}}))}))}}function h(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),Object(i.e)("deals:"+r().events.deviceType+":"+r().events.widgetType+":postPresetInteraction",1),[4,a.refTagService.postPresetInteractionToRefTagService(e,r().events)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),Object(u.e)(t)?t instanceof u.b&&a.logError({message:"Can't post preset interaction event to server dummy endpoint "+e,exception:t}):a.logError({exception:t,message:"Fail during a translation of preset interaction event "+e}),[3,3];case 3:return[2]}}))}))}}function v(e){return function(t,r,a){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),Object(i.e)("deals:"+r().events.deviceType+":"+r().events.widgetType+":postPaginationInteraction",1),[4,a.refTagService.postPaginationInteractionToRefTagService(e,r().events)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),Object(u.e)(t)?t instanceof u.b&&a.logError({message:"Can't post pagination interaction event to server dummy endpoint "+e,exception:t}):a.logError({exception:t,message:"Fail during a translation of pagination interaction event "+e}),[3,3];case 3:return[2]}}))}))}}function I(e){return function(t,r,n){var a=r().events,i=a.requestId,o=a.pageType,s=a.pageId,c=a.placementId,u=a.slotId,l=new URL(e,location.origin);return l.searchParams.append("pf_rd_r",i),l.searchParams.append("pf_rd_t",o),l.searchParams.append("pf_rd_i",s),l.searchParams.append("pf_rd_p",c),l.searchParams.append("pf_rd_s",u),l.href}}function O(e,t){return function(r,n,a){try{return a.refTagService.appendRefTagToDealLink(e,n().events,t)}catch(r){return a.logError({message:"Can't append reftag to deal link, error during translation "+e,exception:r}),t}}}function b(e){return function(t,r,n){try{return n.refTagService.appendRefTagToHelpLink(r().events,e)}catch(t){return n.logError({message:"Can't append reftag to help link, error during translation",exception:t}),e}}}function S(e,t){return function(){return function(e,t){var r=t;try{if(e){var n=new URL(e);n.searchParams.append("url",r),r=n.href}}catch(r){f({message:"Couldn't build SponsoredDealRedirectUrl for SponsoredDealUrl : "+e+" with egress url : "+t,exception:r})}return r}(e,t)}}var D={widgetType:o.t.GRID,pageId:"",pageType:"",slotId:"",sessionId:"",placementId:"",marketplaceId:"",deviceType:o.g.DESKTOP,isApplication:!1,requestId:""},R="STORE_EVENT_METADATA";function _(e,t){switch(void 0===e&&(e=D),t.type){case R:return{widgetType:t.widgetConfiguration.widgetType,pageId:t.widgetConfiguration.renderingContext.pageId,pageType:t.widgetConfiguration.renderingContext.pageType,slotId:t.slotId,sessionId:t.serviceContext.sessionId,placementId:t.widgetConfiguration.renderingContext.placementId,marketplaceId:t.serviceContext.marketplaceId,deviceType:A(t.serviceContext.deviceType),isApplication:t.serviceContext.isApplication,requestId:t.widgetConfiguration.renderingContext.requestId};default:return e}}function A(e){switch(e){case a.a.DESKTOP:return o.g.DESKTOP;case a.a.MOBILE:return o.g.MOBILE;case a.a.TABLET:return o.g.TABLET;case a.a.FIREPHONE:return o.g.FIREPHONE;default:return f({exception:new Error("Can not translate "+e),message:"Can not translate "+e}),o.g.MOBILE}}},"6soB":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return c})),r.d(t,"e",(function(){return u})),r.d(t,"d",(function(){return l}));var n=r("mrSG"),a=r("drbA"),i=r.n(a);function o(e,t){return Object(n.b)(this,void 0,void 0,(function(){var r,o,s,c;return Object(n.d)(this,(function(n){switch(n.label){case 0:r=new a.Event("",a.EventType.OPERATIONAL),(o=new a.TimerMetric(e+":latency",r)).startTimer(),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,t];case 2:return s=n.sent(),r.addMetric(e+":success",1),[3,5];case 3:throw c=n.sent(),r.addMetric(e+":error",1),c;case 4:return o.recordTimer(),i.a.record(r),[7];case 5:return[2,s]}}))}))}function s(e){var t=new a.Event("",a.EventType.OPERATIONAL);t.addMetric(e,1),i.a.record(t)}function c(e,t){var r=new a.Event("",a.EventType.OPERATIONAL);r.addMetric(e,t?1:0),i.a.record(r)}function u(e,t){var r=new a.Event("",a.EventType.OPERATIONAL);r.addMetric(e,t),i.a.record(r)}function l(e,t,r){0!==r&&u(e,0===t?0:t/r)}},"88fb":function(e,t,r){"use strict";var n=r("q1tI"),a=r.n(n).a.createContext({});t.a=a},"9yQ2":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("sEfC"),a=r.n(n);function i(e){return a()(e,1e3/3)}},C4l9:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("i7xV"),a=r("R56J"),i=r("1fPH");function o(e,t){return{dealsIdsStartIndex:s(e.page),totalCount:e.selectedDealsCount||0,dealIds:e.sortedDealIDs||[],sponsoredDealsMetadata:f(t,e.customResponseAttributes),availableFilters:{departments:[],discounts:c(e.binning),priceRanges:u(e.binning),containsPrimeEligible:l(e.binning)}}}function s(e){return e?(e-1)*a.a:0}function c(e){var t=e&&e.discount_range;return t?d(t,100).map((function(e){return{from:e.from,to:e.to}})):[]}function u(e){var t=e&&e.price_range;return t?d(t,n.m):[]}function l(e){var t=e&&e.is_prime;return!!t&&(Boolean(t.true)&&t.true>0)}function d(e,t){return Object.keys(e).map((function(e){var r=e.split("-"),n=r[0],a=r[1];return{from:Number(n)||0,to:Number(a)||t}})).sort((function(e,t){return e.from-t.from}))}function f(e,t){if(null===t||void 0===t?void 0:t.dealsWithBids)return Object.keys(t.dealsWithBids).reduce((function(r,n){return r[n]=function(e,t){var r=new URL("/gp/slredirect/picassoRedirect.html",location.origin);return r.searchParams.append("id",e.logId),r.searchParams.append("adId",e.adId),r.searchParams.append("qualifier",e.qualifier),r.searchParams.append("widgetName",Object(i.a)(t)),r.href}(t.dealsWithBids[n],e),r}),{})}},IOG6:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return c}));var n=1e3,a=60*n,i=60*a,o=24*i;function s(e){return[e.getHours(),e.getMinutes()].map(u).join(":")}function c(e){if(e<=0)return"00:00";var t,r=(t=e,{days:Math.floor(t/o),hours:Math.floor(t/i),minutes:Math.floor(t/a%60),seconds:Math.floor(t/n%60)}),s=r.hours,c=[r.minutes,r.seconds];return s>0&&c.unshift(s),c.map(u).join(":")}function u(e){return e>9?String(e):"0"+e}},JG2M:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("SwSc"),a=r("SrB9");function i(e,t){try{var r={amount:1e3,currency:{currencyCode:e.currencyIsoCode}},i=function(e){return n.a.getInstanceByTypeAndMarketplaceId(e.locale.replace("_","-"),"amazonSymbol",e.marketplaceId)}(e).formatToParts(r).displayFields;return{isoCode:e.currencyIsoCode,symbol:i.currencySymbol,symbolPosition:(s=i.fieldOrder,new Set([2,1,0]).has(s.valueOf())?a.b.LEFT:a.b.RIGHT),decimalSeparator:i.decimalSeparator||"",thousandsSeparator:(o=i.integerValue,o.substring(o.indexOf("1")+1,o.indexOf("0")))}}catch(r){return t.logWarn({exception:r,message:r.message}),{isoCode:e.currencyIsoCode,symbol:e.currencyIsoCode,symbolPosition:a.b.RIGHT,decimalSeparator:",",thousandsSeparator:" "}}var o,s}},LGkc:function(e,t,r){"use strict";r.d(t,"a",(function(){return A}));var n=r("mrSG"),a=r("SrB9"),i=r("6soB"),o=r("i7xV"),s=r("gs7j"),c=r("C4l9");function u(){return window.cordova?"android"===window.cordova.platformId?(Object(i.e)("deals:mash:registerForNotifications:supportedPlatform",1),new Promise((function(e,t){window.P.when("PushNotificationSubscription").execute((function(r){r.setSubscriptions({featureId:"DealsPushNotification",groupId:"DEALS",subscriptionId:"DEALS:waitlist",subscriptionStatus:!0,successCallback:function(){Object(i.e)("deals:mash:registerForNotifications:android:success",1),e({isSubscribed:!0,error:""})},failureCallback:function(e){Object(i.e)("deals:mash:registerForNotifications:android:success",0),t({isSubscribed:!1,error:"Error while trying to register for notifications: "+e})}})}))}))):"ios"===window.cordova.platformId?(Object(i.e)("deals:mash:registerForNotifications:supportedPlatform",1),e=window.cordova.require("cordova/exec"),new Promise((function(t,r){window.P.when("mash").execute((function(){e((function(){Object(i.e)("deals:mash:registerForNotifications:ios:success",1),t({isSubscribed:!0,error:""})}),(function(e){Object(i.e)("deals:mash:registerForNotifications:ios:success",0),r({isSubscribed:!1,error:"Error while trying to register for notifications: "+e})}),"PushNotificationsIOS","invokeSetSubscriptions",["TodaysDeals","DEALS:waitlist"])}))}))):(Object(i.e)("deals:mash:registerForNotifications:supportedPlatform",0),Promise.reject({isSubscribed:!1,error:"Unsupported platform: "+window.cordova.platformId})):(Object(i.e)("deals:mash:registerForNotifications:supportedPlatform",0),Promise.reject({isSubscribed:!1,error:"Cordova not found on page."}));var e}var l,d,f,p,g,T=r("ne7G"),m=r("drbA"),E=r.n(m),h=((l={})[o.t.HERO]="ho",l[o.t.SHOVELER]="sh",l[o.t.GRID]="gd",l),v={0:"underp1",25:"p1top2",50:"p2top3",100:"p3top4",200:"overp4"},I=((d={})[o.d.AVAILABLE]="active",d[o.d.UPCOMING]="upcoming",d[o.d.EXPIRED]="expird",d[o.d.WAITLIST]="waitlist",d[o.d.WAITLISTFULL]="waitlf",d[o.d.SOLDOUT]="sldout",d),O=((f={})[o.f.BEST_DEAL]="besdel",f[o.f.LIGHTNING_DEAL]="ligdel",f[o.f.COUPON_DEAL]="coudel",f[o.f.DEAL_OF_THE_DAY]="topdel",f[o.f.EVENT_DEAL]="qadeal",f),b=((p={})[o.r.BY_BEST_SELLING]="bstsel",p[o.r.BY_CUSTOM_CRITERION]="cstcri",p[o.r.BY_DISCOUNT_ASCENDING]="dsclth",p[o.r.BY_DISCOUNT_DESCENDING]="dschtl",p[o.r.BY_PRICE_ASCENDING]="prclth",p[o.r.BY_PRICE_DESCENDING]="prchtl",p[o.r.BY_SCORE]="rnkhtl",p[o.r.TRENDING]="trndng",p[o.r.COHORTING]="chrtng",p[o.r.RANDOM]="rnd",p),S=((g={})[o.c.IMG]="img",g[o.c.ADD_TO_CART]="atc",g[o.c.COLLECT_VOUCHERS]="cov",g[o.c.STAR_RATING]="str",g[o.c.TITLE]="tlt",g[o.c.UNWATCH]="uwt",g[o.c.WATCH]="wat",g[o.c.WAIT_LIST]="wtl",g[o.c.VIEW_ALL_ITEMS]="vai",g[o.c.LEARN_MORE]="lmr",g[o.c.SIGN_UP_FOR_PRIME]="sup",g[o.c.VIEW_OPTIONS]="vop",g[o.c.VIEW_DETAILS]="vdt",g),D=function(){function e(e){this.loggerService=e}return e.prototype.transformDealInteractionToRefTag=function(e,t){return this.joinRefTagParts(["dcl",S[e.source],String(e.dealRank),e.dealID],t)},e.prototype.transformDepartmentFilterToRefTag=function(e,t){return this.joinRefTagParts([this.transformDepartmentToFilterTypeRefTag(e),"dep",e.id],t)},e.prototype.transformDepartmentToFilterTypeRefTag=function(e){return e.selected?"fil":"fic"},e.prototype.transformDepartmentFilterClearToRefTag=function(e){return this.joinRefTagParts(["fic","dep","clrdep"],e)},e.prototype.transformDepartmentFilterSelectAllToRefTag=function(e){return this.joinRefTagParts(["fil","dep","alldep"],e)},e.prototype.transformPriceRangeFilterToRefTag=function(e,t){return this.joinRefTagParts(["fil","pri",this.transformPriceRangeToRefTag(e)],t)},e.prototype.transformDiscountFilterToRefTag=function(e,t){return this.joinRefTagParts(["fil","dis",this.transformDiscountToRefTag(e)],t)},e.prototype.transformPrimeFilterToRefTag=function(e,t){return this.joinRefTagParts([this.transformPrimeToFilterTypeRefTag(e),"pme","prmeli"],t)},e.prototype.transformPrimeToFilterTypeRefTag=function(e){return e?"fil":"fic"},e.prototype.transformDealStateFilterToRefTag=function(e,t){return this.joinRefTagParts(["fil","ava",I[e]],t)},e.prototype.transformDealStateFilterClearToRefTag=function(e){return this.joinRefTagParts(["fil","ava","allsta"],e)},e.prototype.transformDealTypeFilterToRefTag=function(e,t){return this.joinRefTagParts(["fil","dty",O[e]],t)},e.prototype.transformDealTypeFilterClearToRefTag=function(e){return this.joinRefTagParts(["fil","dty","alldel"],e)},e.prototype.transformStarRatingFilterToRefTag=function(e,t){return this.joinRefTagParts([this.transformStarRatingToFilterTypeRefTag(e),"rev",this.transformStarRatingToRefTag(e)],t)},e.prototype.transformStarRatingToFilterTypeRefTag=function(e){return e===o.a?"fic":"fil"},e.prototype.transformSortingStrategyFilterToRefTag=function(e,t){var r=e!==o.a?b[e]:o.b;return this.joinRefTagParts(["fil","sor",r],t)},e.prototype.transformPriceRangeToRefTag=function(e){return e===o.a?"allpri":v[e.from]},e.prototype.transformDiscountToRefTag=function(e){return e===o.a||e.from===o.a?"alldsct":"dsct"+e.from},e.prototype.transformStarRatingToRefTag=function(e){return e===o.a?"strclr":"str"+e+"up"},e.prototype.transformDeviceTypeToRefTag=function(e,t){switch(e){case o.g.DESKTOP:return"dt";case o.g.TABLET:return t?"ta":"tw";case o.g.MOBILE:case o.g.FIREPHONE:return t?"ma":"mw"}},e.prototype.transformPlacementIdToRefTag=function(e){return e.slice(-2)},e.prototype.transformPresetInteractionToRefTag=function(e,t){return this.joinRefTagParts(["fil","col",this.transformPresetIdToRefTag(e.presetId)],t)},e.prototype.transformPresetIdToRefTag=function(e){var t=e.replace(/deals-collection|-/g,"");return t.length<6?t:t.slice(0,3)+t.slice(-3)},e.prototype.transformGridPresetsCarouselPaginationToRefTag=function(e,t){return this.joinRefTagParts(["views","csh",this.transformPageToRefTag(e,"cs")],t)},e.prototype.transformGridPaginationToRefTag=function(e,t){return this.joinRefTagParts(["views","pag",this.transformPageToRefTag(e,"pg")],t)},e.prototype.transformShovelerPaginationToRefTag=function(e,t){return this.joinRefTagParts(["views","dsh",this.transformPageToRefTag(e,"ds")],t)},e.prototype.transformHeroShovelerPaginationToRefTag=function(e,t){return this.joinRefTagParts(["views","dhe",this.transformPageToRefTag(e,"dh")],t)},e.prototype.transformPageToRefTag=function(e,t){return e<9999?t+("0000"+e).slice(-4):t+e},e.prototype.transformHelpInteractionToRefTag=function(e){return this.joinRefTagParts(["hlp"],e)},e.prototype.joinRefTagParts=function(e,t){var r=Object(n.f)(["dlx",this.transformPageIdToRefTag(t.pageId),this.transformWidgetTypeToRefTag(t.widgetType)],e,[this.transformDeviceTypeToRefTag(t.deviceType,t.isApplication),this.transformSlotIdToRefTag(t.slotId),this.transformPlacementIdToRefTag(t.placementId)]).join("_");return r.length>64?(this.recordRefTagLengthError(r),r.slice(0,64)):r},e.prototype.transformPageIdToRefTag=function(e){return e.slice(0,5)},e.prototype.transformWidgetTypeToRefTag=function(e){return h[e]},e.prototype.transformSlotIdToRefTag=function(e){return e.split("-").map((function(e){return e.slice(0,2)})).join("")},e.prototype.recordRefTagLengthError=function(e){var t=new m.Event("",m.EventType.OPERATIONAL);t.addMetric("reftag:maxlength:exceed",1),E.a.record(t);var r=new Error("RefTag max length is exceed: "+e);this.loggerService.logError({exception:r,message:r.message})},e}(),R=function(){function e(e){this.loggerService=e,this.refTagTransformer=new D(e)}return e.prototype.recordDealInteractionRefTag=function(e,t){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(r){switch(r.label){case 0:return[4,this.postRefTagToService(this.refTagTransformer.transformDealInteractionToRefTag(e,t))];case 1:return r.sent(),[2]}}))}))},e.prototype.postPresetInteractionToRefTagService=function(e,t){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(r){switch(r.label){case 0:return[4,this.postRefTagToService(this.refTagTransformer.transformPresetInteractionToRefTag(e,t))];case 1:return r.sent(),[2]}}))}))},e.prototype.postPaginationInteractionToRefTagService=function(e,t){switch(e.source){case o.n.GRID_PRESETS_CAROUSEL:return this.postRefTagToService(this.refTagTransformer.transformGridPresetsCarouselPaginationToRefTag(e.page,t));case o.n.GRID_PAGINATION:return this.postRefTagToService(this.refTagTransformer.transformGridPaginationToRefTag(e.page,t));case o.n.DEALS_SHOVELER:return this.postRefTagToService(this.refTagTransformer.transformShovelerPaginationToRefTag(e.page,t));case o.n.DEALS_HERO_SHOVELER:return this.postRefTagToService(this.refTagTransformer.transformHeroShovelerPaginationToRefTag(e.page,t))}},e.prototype.postFilterInteractionToRefTagService=function(e,t){return Object(n.b)(this,void 0,void 0,(function(){var r;return Object(n.d)(this,(function(n){switch(n.label){case 0:return(r=e.filterUpdate).departments===o.l?[3,2]:[4,this.postDepartmentFilterInteractionToRefTagService(r.departments,t)];case 1:n.sent(),n.label=2;case 2:return r.prime===o.l?[3,4]:[4,this.postRefTagToService(this.refTagTransformer.transformPrimeFilterToRefTag(r.prime,t))];case 3:n.sent(),n.label=4;case 4:return r.starRating===o.l?[3,6]:[4,this.postRefTagToService(this.refTagTransformer.transformStarRatingFilterToRefTag(r.starRating,t))];case 5:n.sent(),n.label=6;case 6:return r.dealStates===o.l?[3,8]:[4,this.postDealStateFilterInteractionToRefTagService(r.dealStates,t)];case 7:n.sent(),n.label=8;case 8:return r.dealTypes===o.l?[3,10]:[4,this.postDealTypeFilterInteractionToRefTagService(r.dealTypes,t)];case 9:n.sent(),n.label=10;case 10:return r.starRating===o.l?[3,12]:[4,this.postRefTagToService(this.refTagTransformer.transformStarRatingFilterToRefTag(r.starRating,t))];case 11:n.sent(),n.label=12;case 12:return r.sorting===o.l?[3,14]:[4,this.postRefTagToService(this.refTagTransformer.transformSortingStrategyFilterToRefTag(r.sorting,t))];case 13:n.sent(),n.label=14;case 14:return r.discount===o.l?[3,16]:[4,this.postRefTagToService(this.refTagTransformer.transformDiscountFilterToRefTag(r.discount,t))];case 15:n.sent(),n.label=16;case 16:return r.priceRange===o.l?[3,18]:[4,this.postRefTagToService(this.refTagTransformer.transformPriceRangeFilterToRefTag(r.priceRange,t))];case 17:n.sent(),n.label=18;case 18:return[2]}}))}))},e.prototype.postDealTypeFilterInteractionToRefTagService=function(e,t){var r=this;return e===o.a?this.postRefTagToService(this.refTagTransformer.transformDealTypeFilterClearToRefTag(t)):Promise.all(e.map((function(e){return r.postRefTagToService(r.refTagTransformer.transformDealTypeFilterToRefTag(e,t))})))},e.prototype.postDepartmentFilterInteractionToRefTagService=function(e,t){var r=this;switch(e){case o.a:return this.postRefTagToService(this.refTagTransformer.transformDepartmentFilterClearToRefTag(t));case o.q:return this.postRefTagToService(this.refTagTransformer.transformDepartmentFilterSelectAllToRefTag(t));default:return Promise.all(e.map((function(e){return r.postRefTagToService(r.refTagTransformer.transformDepartmentFilterToRefTag(e,t))})))}},e.prototype.postDealStateFilterInteractionToRefTagService=function(e,t){var r=this;return e===o.a?this.postRefTagToService(this.refTagTransformer.transformDealStateFilterClearToRefTag(t)):Promise.all(e.map((function(e){return r.postRefTagToService(r.refTagTransformer.transformDealStateFilterToRefTag(e,t))})))},e.prototype.postRefTagToService=function(e){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(e){return[2]}))}))},e.prototype.appendRefTagToDealLink=function(e,t,r){var n=new URL(r,location.origin);return n.searchParams.set("ref",this.refTagTransformer.transformDealInteractionToRefTag(e,t)),n.href},e.prototype.appendRefTagToHelpLink=function(e,t){var r=new URL(t,location.origin);return r.searchParams.set("ref",this.refTagTransformer.transformHelpInteractionToRefTag(e)),r.href},e}(),_="deals:deals-grid:mobile:deal-card:has-overflow",A=function(){function e(e,t,r,n,i,o){this.serviceContext=e,this.maxTotalNumberOfDeals=t,this.dcsService=r,this.aapiService=n,this.loggerService=i,this.redirectService=o,this.isOverflowMetricRecorded=!1,this.refTagService=new R(i),this.redirectService=new T.a,this.isSearchDealsFromAapiEnabled=e.weblabs.DEALS_SEARCH_DEALS_FROM_AAPI_413165===a.c.T1}return e.prototype.searchDeals=function(e,t){if(!e)throw new Error("No filters selected for search");return this.isSearchDealsFromAapiEnabled?this.aapiService.searchDeals(e,t):this.dcsService.searchDealsFromDcs(e,t,this.maxTotalNumberOfDeals)},e.prototype.getDealsByIds=function(e,t){return void 0===t&&(t=!1),this.aapiService.getDealsByIdsFromAAPI(e,t)},e.prototype.getPrefetchedSearchResults=function(t){var r;return e.normalizePrefetchedSearchResults(this.isSearchDealsFromAapiEnabled?this.aapiService.transformDealsSearchResult(null===(r=t.aapiSearchDeals)||void 0===r?void 0:r.entity,t.aapiSearchDealsStartIndex,t.aapiSearchDealsTotalCount):Object(c.a)(t.dcsGetDealMetadata||{},this.serviceContext.deviceType))},e.prototype.getPrefetchedDeals=function(e,t,r,n,a){var i;if(e.aapiGetDealsList){var o=this.aapiService.transformDealCollections(e.aapiGetDealsList.map((function(e){return{collection:e,serverTimeUtc:r}})),!1);return this.fillViewport(o,this.isSearchDealsFromAapiEnabled?t.dealIds:(null===(i=e.dcsGetDealMetadata)||void 0===i?void 0:i.sortedDealIDs)||[],a,n)}return[]},e.prototype.fetchWatchlist=function(){return this.aapiService.getWatchedDeals()},e.prototype.watchDeal=function(e){return this.aapiService.setWatchedDealStatus(e,o.s.ADD)},e.prototype.unwatchDeal=function(e){return this.aapiService.setWatchedDealStatus(e,o.s.REMOVE)},e.prototype.subscribeToNotifications=function(){return u()},e.showNativeOverlayElements=function(){null===window||void 0===window||window.P.when("mash").execute((function(e){e.dispatchEvent({type:"appOverlays.Show"})}))},e.hideNativeOverlayElements=function(){null===window||void 0===window||window.P.when("mash").execute((function(e){e.dispatchEvent({type:"appOverlays.Hide"})}))},e.prototype.getCustomerId=function(){return this.serviceContext.customerId},e.prototype.isApplication=function(){return this.serviceContext.isApplication},e.prototype.loginAndRedirect=function(){return this.redirectService.loginAndRedirect()},e.isNotRetryableStatus=function(e){return s.a.isNotRetryableStatus(e)},e.prototype.fillViewport=function(e,t,r,n){var a=this.isSearchDealsFromAapiEnabled?r:r%300;return e.concat(t.slice(a+e.length,Math.min(t.length,a+n)).map((function(e){return{dealID:e,dealRank:0}})))},e.normalizePrefetchedSearchResults=function(e){return Object(n.a)(Object(n.a)({},e),{dealIds:Array.from(Array(e.dealsIdsStartIndex)).concat(e.dealIds)})},e.prototype.logError=function(e,t){this.loggerService.logError(e,t)},e.prototype.logFatal=function(e){this.loggerService.logFatal(e)},e.prototype.logWarn=function(e){this.loggerService.logWarn(e)},e.prototype.logInfo=function(e){this.loggerService.logInfo(e)},e.prototype.logOverflowError=function(e){this.loggerService.logInfo(e),this.isOverflowMetricRecorded||(Object(i.e)(_,1),this.loggerService.logError(e,_),this.isOverflowMetricRecorded=!0)},e.prototype.initOverflowMetric=function(){Object(i.e)(_,0)},e}()},NfFx:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return d}));var n,a,i,o=r("mrSG"),s=r("i7xV");!function(e){e.AVAILABLE="AVAILABLE",e.UPCOMING="UPCOMING",e.WAITLIST="WAITLIST",e.WAITLISTFULL="WAITLISTFULL",e.SOLDOUT="SOLDOUT",e.EXPIRED="EXPIRED"}(n||(n={})),function(e){e.DEAL_OF_THE_DAY="DEAL_OF_THE_DAY",e.LIGHTNING_DEAL="LIGHTNING_DEAL",e.BEST_DEAL="BEST_DEAL",e.EVENT_DEAL="EVENT_DEAL",e.COUPON_DEAL="COUPON_DEAL"}(a||(a={})),function(e){e.BY_SCORE="BY_SCORE",e.BY_DISCOUNT_ASCENDING="BY_DISCOUNT_ASCENDING",e.BY_DISCOUNT_DESCENDING="BY_DISCOUNT_DESCENDING",e.BY_PRICE_ASCENDING="BY_PRICE_ASCENDING",e.BY_PRICE_DESCENDING="BY_PRICE_DESCENDING",e.BY_BEST_SELLING="BY_BEST_SELLING",e.TRENDING="TRENDING",e.COHORTING="COHORTING",e.RANDOM="RANDOM",e.BY_CUSTOM_CRITERION="BY_CUSTOM_CRITERION",e.FEATURED="FEATURED"}(i||(i={}));var c=[s.r.BY_DISCOUNT_ASCENDING,s.r.BY_DISCOUNT_DESCENDING,s.r.BY_PRICE_ASCENDING,s.r.BY_PRICE_DESCENDING];function u(e,t,r,s){return Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)({version:1,viewIndex:r,presetId:e},(I=t.discountRanges).find((function(e){return e.selected}))?{discountRanges:I}:{}),function(e){return e?{showWatchlist:!0}:{}}(s)),(h=t.departments,(v=h.filter((function(e){return e.selected})).map((function(e){return e.id}))).length?{departments:v}:{})),(m=t.priceRanges,(E=m.filter((function(e){return e.selected})).map((function(e){return{from:e.from,to:e.to}}))).length?{priceRange:E[0]}:{})),t.prime.selected?{prime:!0}:{}),t.primeEarlyAccess.selected?{primeEarlyAccess:!0}:{}),t.primeExclusive.selected?{primeExclusive:!0}:{}),t.appOnly.selected?{appOnly:!0}:{}),(g=t.dealStates,(T=g.filter((function(e){return e.selected})).map((function(e){return n[e.dealState]}))).length?{dealState:T[0]}:{})),(f=t.dealTypes,(p=f.filter((function(e){return e.selected})).map((function(e){return a[e.dealType]}))).length?{dealType:p[0]}:{})),(d=t.sorting,{sorting:c.includes(d)?i[d]:i.FEATURED})),(u=t.starRatings,(l=u.filter((function(e){return e.selected})).map((function(e){return e.stars}))).length?{starRating:l[0]}:{}));var u,l,d,f,p,g,T,m,E,h,v,I}function l(e,t,r,n){var a;a=d(e,t,r,n),history.replaceState(history.state,document.title,a.href)}function d(e,t,r,n){var a=new URL(window.location.href),i=u(e,t,r,n);return a.searchParams.set("deals-widget",encodeURIComponent(JSON.stringify(i))),a}},Qjkb:function(e,t,r){"use strict";function n(){var e,t=null===(e=document.querySelector('meta[name="encrypted-slate-token"]'))||void 0===e?void 0:e.getAttribute("content");return t?{"x-amzn-encrypted-slate-token":t}:null}r.d(t,"a",(function(){return n}))},R56J:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var n=300,a=1e4},SN2E:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return s}));var n=r("SrB9");function a(e,t){return Number.isFinite(e)?String(c(e,t.decimalSeparator?2:0,t)):""}function i(e,t){if(null===e||!Number.isFinite(e))return"";var r=Math.abs(e),n=Math.ceil(10*(r<1?r:r%Math.floor(r))),a=t.decimalSeparator&&n>0;return String(c(e,a?2:0,t))}function o(e,t){return t.symbolPosition===n.b.LEFT?""+t.symbol+e:""+e+t.symbol}function s(e,t){if(null===e||!Number.isFinite(e))return"";var r=t.symbolPosition===n.b.LEFT?t.symbol:"",a=t.symbolPosition===n.b.RIGHT?t.symbol:"";return""+r+c(e,0,t)+a}function c(e,t,r){return Intl.NumberFormat("en-us",{minimumFractionDigits:t,maximumFractionDigits:t}).format(e).replace(",","T").replace(".","D").replace("T",r.thousandsSeparator).replace("D",r.decimalSeparator)}},SrB9:function(e,t,r){"use strict";var n,a,i,o;r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return o})),function(e){e.LEFT="left",e.RIGHT="right"}(n||(n={})),function(e){e.NONE="none",e.PRIME="prime",e.BUSINESS_PRIME="business_prime"}(a||(a={})),function(e){e.MOBILE="mobile",e.TABLET="tablet",e.DESKTOP="desktop",e.FIREPHONE="firephone"}(i||(i={})),function(e){e.C="C",e.T1="T1",e.T2="T2",e.T3="T3",e.T4="T4",e.T6="T6",e.T8="T8",e.T11="T11",e.T14="T14"}(o||(o={}))},UQr2:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i}));var n="PageFrameworkApplication",a="ATVPDKIKX0DER",i=window.Globals.pageContext},aE9G:function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return m}));var n=r("mrSG"),a=r("drbA"),i=r.n(a),o=r("Tm1B"),s=r.n(o),c=r("D0BC"),u=r.n(c),l=function(e){function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object(n.c)(t,e),t}(Error),d=function(e){function t(r,n){var a=e.call(this,r)||this;return a.status=n,Object.setPrototypeOf(a,t.prototype),a}return Object(n.c)(t,e),t}(Error),f=function(e){function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object(n.c)(t,e),t}(Error);function p(e){var t;return Object(n.b)(this,void 0,void 0,(function(){var r,a,i;return Object(n.d)(this,(function(o){switch(o.label){case 0:r=g(e.retryTimoutInMs,e.maxRetries,e.enableRetries,e.isRetryableError,e.apiName),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,r(e.requestUri,Object(n.a)(Object(n.a)({},e.credentials&&{credentials:e.credentials}),{headers:e.headers,method:e.method,body:e.body}))];case 2:if(!(a=o.sent()).ok)throw new d("url: "+a.url+" message: '"+a.statusText+"' status: "+a.status+" "+((null===(t=e.apiName)||void 0===t?void 0:t.includes("aapi"))&&a.headers?(s=a.headers,"headers: "+JSON.stringify({"x-amz-rid":s.get("x-amz-rid"),"x-amzn-service-hostname":s.get("x-amzn-service-hostname"),date:s.get("date")})):""),a.status);return[4,a.json()];case 3:return[2,{data:o.sent(),headers:a.headers}];case 4:throw(i=o.sent())instanceof d?i:new l(i.message);case 5:return[2]}var s}))}))}function g(e,t,r,a,i){return s()(window.fetch,{retryDelay:function(t){return function(e,t){return Math.pow(2,e)*(t+u()(-1e3,1e3))}(t,e)},retryOn:function(e,o,s){return function(e){return Object(n.b)(this,void 0,void 0,(function(){var t,r,a,i,o,s,c,u,l;return Object(n.d)(this,(function(n){switch(n.label){case 0:return t=e.attempt,r=e.apiName,a=e.maxRetries,i=e.enableRetries,o=e.response,s=e.error,c=e.recordRetryMetrics,u=e.isRetryableError,t>=a||!i?[2,!1]:[4,u(o)];case 1:return l=n.sent(),null!==s||l?(r&&c(r),[2,!0]):[2,!1]}}))}))}({attempt:e,error:o,response:s,maxRetries:t,apiName:i,enableRetries:r,isRetryableError:a,recordRetryMetrics:T})}})}function T(e){var t=new a.Event("",a.EventType.OPERATIONAL);t.addMetric(e+":retry",1),i.a.record(t)}function m(e){var t="Failed to fetch"===e.message;return e instanceof l||e instanceof d||t}},b9ts:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u}));var n,a=r("q1tI"),i=r.n(a),o=r("SrB9");function s(e){void 0===e&&(e=o.a.MOBILE);var t=screen.width,r=screen.height;return{largeDevice:e!==o.a.MOBILE,screenHeight:r,screenWidth:t,orientation:t>r?n.LANDSCAPE:n.PORTRAIT}}!function(e){e[e.PORTRAIT=0]="PORTRAIT",e[e.LANDSCAPE=1]="LANDSCAPE"}(n||(n={}));var c=i.a.createContext(s());function u(e){var t=Object(a.useState)(s(e.deviceType)),r=t[0],n=t[1];return Object(a.useEffect)((function(){function t(){n(s(e.deviceType))}return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[e.deviceType]),i.a.createElement(c.Provider,{value:r},e.children)}},buYj:function(e,t,r){"use strict";r.r(t);r("2ITb"),r("ycHY"),r("qxpy"),r("ftu+"),r("Q7Ty"),r("l6Ro"),r("Si7d"),r("H+SE"),r("6Dc4"),r("rmf8"),r("Wr5T"),r("bZMm"),r("riHO"),r("/xOi");var n=r("q1tI"),a=r.n(n),i=r("i8i4"),o=r("/MKj"),s=r("drbA"),c=r.n(s),u=r("UQr2"),l=r("mZCz"),d=function(){function e(e,t){this.serviceContext=e,this.elsaService=t}return e.prototype.logError=function(e,t){"AAHKV2X7AFYLW"!==this.serviceContext.marketplaceId&&this.elsaService.logData(l.a.ERROR,e),l.b.error(e,t)},e.prototype.logFatal=function(e){"AAHKV2X7AFYLW"!==this.serviceContext.marketplaceId&&this.elsaService.logData(l.a.FATAL,e),l.b.fatal(e)},e.prototype.logWarn=function(e){"AAHKV2X7AFYLW"!==this.serviceContext.marketplaceId&&this.elsaService.logData(l.a.WARN,e),l.b.warn(e)},e.prototype.logInfo=function(e){"AAHKV2X7AFYLW"!==this.serviceContext.marketplaceId&&this.elsaService.logData(l.a.INFO,e)},e}(),f=function(){function e(){}return e.prototype.getName=function(){return"CSA_METRICS_PROVIDER"},e.prototype.recordEvent=function(e){var t=this;if(this.initCsaPlugins()&&void 0!==this.pageLatencyPlugin){var r=e.getEventData(),n=r.name;n&&this.pageLatencyPlugin("mark",n),Object.keys(r.metrics).forEach((function(e){t.metricsPlugin&&t.metricsPlugin("recordMetric",e,r.metrics[e])})),Object.keys(r.timers).forEach((function(e){t.metricsPlugin&&t.metricsPlugin("recordMetric",e,r.timers[e])}))}},e.prototype.initCsaPlugins=function(){return window.csa&&(this.pageLatencyPlugin||(this.pageLatencyPlugin=window.csa("PageTiming")),this.metricsPlugin=window.csa("Metrics",{producerId:"goldbox"})),Boolean(this.metricsPlugin&&this.pageLatencyPlugin)},e}(),p=r("i7xV"),g=r("aUsF"),T=r.n(g),m=r("NfFx"),E=r("9yQ2");function h(e){var t=e.getState(),r=Object(E.a)((function(){var r,n,a=e.getState();n=a,(r=t).filters.currentPreset.presetId===n.filters.currentPreset.presetId&&T()(r.filters.filterSelection,n.filters.filterSelection)&&r.deals.index===n.deals.index&&r.watchedDeals.isWatchlistActive===n.watchedDeals.isWatchlistActive||(Object(m.b)(a.filters.currentPreset.presetId,a.filters.filterSelection,a.deals.index,a.watchedDeals.isWatchlistActive),t=a)}));e.subscribe(r)}var v,I,O,b=r("gs7j"),S=r("LGkc"),D=r("mrSG"),R=r("SER8"),_=r.n(R),A=r("u6S6"),y=r.n(A),C=r("6soB"),N=r("aE9G"),L=r("Qjkb"),P=r("R56J"),w=r("1fPH"),j=[{count:20,name:"discount_range"},{count:20,name:"price_range"},{count:100,name:"whitelist_categories"},{count:2,name:"is_prime"}],x=((v={})[p.f.DEAL_OF_THE_DAY]="DEAL_OF_THE_DAY",v[p.f.LIGHTNING_DEAL]="LIGHTNING_DEAL",v[p.f.BEST_DEAL]="BEST_DEAL",v[p.f.COUPON_DEAL]="COUPON_DEAL",v[p.f.EVENT_DEAL]="EVENT_DEAL",v),M=((I={})[p.d.AVAILABLE]="AVAILABLE",I[p.d.UPCOMING]="UPCOMING",I[p.d.EXPIRED]="EXPIRED",I[p.d.SOLDOUT]="SOLDOUT",I[p.d.WAITLIST]="WAITLIST",I[p.d.WAITLISTFULL]="WAITLISTFULL",I),F=((O={})[p.e.QA]="QA",O);function G(e,t){return Math.floor(e/t)+1}function U(e){var t=e.find((function(e){return e.selected}));return t?{discountRanges:e.map((function(r,n){var a=r.from,i=r.to;return a<t.from?null:e.length-1>n?a+"-"+e[n+1].from:i&&100!==i?a+"-"+i:a+"-"})).filter(B)}:{}}function B(e){return!!e}function H(e,t,r){if(e===p.r.BY_CUSTOM_CRITERION&&t)return t.sponsoredDealExperiment?{__type:"SponsoredDealsRequestAttributes:http://internal.amazon.com/coral/com.amazon.dcs.model.v2/",populateSponsoredDealAttributes:!0,widgetName:Object(w.a)(r.deviceType),interestBasedAdsOptOut:r.interestBasedAdsOptOut,ipAddress:r.clientIpAddress,experimentName:t.sponsoredDealExperiment.toLowerCase(),experiments:{DEALS_RANKING_EXPERIMENT:t.rankingTreatment}}:{__type:"ExperimentSupportedCustomAttributes:http://internal.amazon.com/coral/com.amazon.dealsdiscovery.shared/",experiments:{DEALS_RANKING_EXPERIMENT:t.rankingTreatment}}}var W,Y,k=r("C4l9"),V=function(){function e(e,t,r,n,a){this.serviceContext=e,this.widgetType=t,this.pageType=r,this.pageId=n,this.slot=a,this.dcsClientWithoutCustomerContext=new _.a(this.createExecutor({attachCustomerContext:!1,attachItemResponseSize:!1}))}return e.prototype.searchDealsFromDcs=function(t,r,n){return Object(D.b)(this,void 0,void 0,(function(){var a,i;return Object(D.d)(this,(function(o){switch(o.label){case 0:return a=function(e,t,r){return{page:G(t,P.a),version:"V2.2",sortOrder:e.sorting===p.r.COHORTING||e.sorting===p.r.RANDOM?p.r.BY_SCORE:e.sorting,dealsPerPage:P.a,customRequestAttributes:H(e.sorting,e.customCriterionAttributes,r),queryProfile:Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)(Object(D.a)({},(R=e.prime,R.selected?{primeEligibleOnly:!0}:{})),(O=e.departments,b=!O.find((function(e){var t=e.selected;return t})),S=O.filter((function(e){var t=e.selected,r=e.enforced;return t||b&&r})).map((function(e){var t=e.id;return t})),S.length?{includedCategories:S}:{})),(v=e.dealTypes,I=v.filter((function(e){var t=e.selected;return t})).map((function(e){var t=e.dealType;return x[t]})),I.length?{dealTypes:I}:{dealTypes:v.map((function(e){var t=e.dealType;return x[t]}))})),(E=e.dealStates,h=E.filter((function(e){var t=e.selected;return t})).map((function(e){var t=e.dealState;return M[t]})),h.length?{dealStates:h}:{dealStates:E.map((function(e){var t=e.dealState;return M[t]}))})),(T=e.priceRanges,m=T.filter((function(e){var t=e.selected;return t})).map((function(e){var t=e.from,r=e.to;return(t||"")+"-"+(r===p.m?"":r)})),m.length?{priceRanges:m}:{})),U(e.discountRanges)),(f=e.starRatings,g=f.find((function(e){var t=e.selected;return t})),g?{minRating:g.stars}:{})),(d=e.marketingTagsExcluded,d.length?{excludedExtendedFilters:{MARKETING_ID:d}}:{})),(l=e.marketingTagsIncluded,l.length?{extendedFilters:{MARKETING_ID:l}}:{})),(u=e.dealGroups,u.length?{dealGroups:u.reduce((function(e,t,r){var n;return Object.assign(e,((n={})[r+1]=t,n))}),{})}:{})),(c=e.dealIdsIncluded,c.length?{includedDealIDs:c}:{})),(s=e.dealIdsExcluded,s.length?{excludedDealIDs:s}:{})),(o=e.expiringWithin,o?{expiringWithin:o}:{})),(i=e.geoSearchQueryTerms,i.length>0?{geoSearchQueryTerms:i}:{})),(a=e.minDurationInMinutes,a?{minDuration:a}:{})),(n=e.exclusiveTarget,n?{exclusiveTargetTypes:[F[n.type]],exclusiveTargetValues:[{name:n.name,value:n.value}]}:{})),{includedBins:j})};var n,a,i,o,s,c,u,l,d,f,g,T,m,E,h,v,I,O,b,S,R}(t,r,this.serviceContext),[4,Object(C.a)("deals:dcs:getDealMetadata",this.dcsClientWithoutCustomerContext.getDealMetadata(a))];case 1:return i=o.sent(),this.extractAndSetContinueRetires(i),[2,e.applyMaxTotalNumberOfDeals(Object(k.a)(i,this.serviceContext.deviceType),P.a,P.b,n)]}}))}))},e.prototype.extractAndSetContinueRetires=function(e){e.responseMetadata&&(this.serviceContext.services.dcs.enableRetries=Boolean(e.responseMetadata.continueRetries))},e.prototype.createExecutor=function(t){var r=this;return function(n,a,i){return Object(D.b)(r,void 0,void 0,(function(){var r,n,o,s,c,u,l,d;return Object(D.d)(this,(function(f){switch(f.label){case 0:return r=this.serviceContext.services.dcs,n=r.maxRetries,o=r.retryTimoutInMs,s=r.uri,c=r.enableRetries,u=t.attachCustomerContext?{customerContext:{languageOfPreference:this.serviceContext.locale,currencyOfPreference:this.serviceContext.currencyIsoCode}}:{},l={"Content-Type":"application/json"},d=this.serviceContext.isInternal?Object(D.a)(Object(D.a)(Object(D.a)({},l),Object(L.a)()),{"x-requested-with":"XMLHttpRequest","X-AMZN-TEST-CALL":"true"}):l,[4,Object(N.c)({requestUri:""+s+a.http.requestUri,method:a.http.method,apiName:"deals:dcs:"+y()(a.name),headers:d,body:JSON.stringify(Object(D.a)(Object(D.a)(Object(D.a)({},i),u),{itemResponseSize:"NO_ITEMS_WITH_PREEMPTIVE_LEAKING",requestMetadata:{clientID:"DealsFE",marketplaceID:this.serviceContext.marketplaceId,sessionID:this.serviceContext.sessionId,customerID:this.serviceContext.customerId},widgetContext:{widgetID:this.widgetType+"_"+this.slot,pageTypeID:this.pageId,pageType:this.pageType}})),isRetryableError:e.isRetryableError,retryTimoutInMs:o,maxRetries:n,enableRetries:c})];case 1:return[2,f.sent().data]}}))}))}},e.isRetryableError=function(e){return!(!e||400===e.status||503===e.status)&&e.status>400},e.applyMaxTotalNumberOfDeals=function(e,t,r,n){if(n<0||r<=n)return e;var a=Math.max(Math.min(e.dealsIdsStartIndex+t,n)-e.dealsIdsStartIndex,0);return e.dealIds=e.dealIds.slice(0,a),e.totalCount=Math.min(e.totalCount,n),e},e}();!function(e){e.NA="na",e.EU="eu",e.FE="fe"}(W||(W={})),function(e){e.IAD="IAD",e.DUB="DUB",e.PDX="PDX"}(Y||(Y={}));var z,q,K,X,J,Q;!function(e){e.Development="development",e.Production="production"}(z||(z={})),function(e){e.Internal="1",e.External="0"}(q||(q={}));var Z,$=((K={})[W.NA]=Y.IAD,K[W.EU]=Y.DUB,K[W.FE]=Y.PDX,K);!function(e){e.test="test",e.prod="prod"}(Z||(Z={}));var ee=((X={})[Z.test]=((J={})[W.EU]="com.amazon.DealsWidgetsHorizonteFrontend.EU.Beta.elsalog",J[W.NA]="com.amazon.DealsWidgetsHorizonteFrontend.EU.Beta.elsalog",J[W.FE]="com.amazon.DealsWidgetsHorizonteFrontend.EU.Beta.elsalog",J),X[Z.prod]=((Q={})[W.NA]="com.amazon.DealsWidgetsHorizonteFrontend.NA.Prod.elsalog",Q[W.EU]="com.amazon.DealsWidgetsHorizonteFrontend.EU.Prod.elsalog",Q[W.FE]="com.amazon.DealsWidgetsHorizonteFrontend.FE.Prod.elsalog",Q),X);var te=function(){function e(e,t,r,n){var a,i;this.serviceContext=e,this.widgetType=t,this.slot=r,this.renderingContext=n,this.region=(a=this.serviceContext.services.elsa.uri,Object.values(W).find((function(e){return e===function(e){return e.substring(e.indexOf("-")+1,e.indexOf("."))}(a)}))||W.NA),this.cluster=(i=this.region,$[i]);var o={"Content-Type":"application/json"};this.headers=this.serviceContext.isInternal?Object(D.a)(Object(D.a)({},o),{"x-reqPuested-with":"XMLHttpRequest","X-AMZN-TEST-CALL":"true"}):o,this.logDataRequest=this.createLogData(),this.rawRequest=this.createRawRequest(),this.contextMap=this.createContextMap()}return e.prototype.logData=function(t,r){return Object(D.b)(this,void 0,void 0,(function(){var n,a,i,o,s,c;return Object(D.d)(this,(function(u){switch(u.label){case 0:return n=this.serviceContext.services.elsa,a=n.maxRetries,i=n.retryTimoutInMs,o=n.uri,s=n.enableRetries,c=Object(D.a)(Object(D.a)({},this.logDataRequest),{_raw:JSON.stringify(Object(D.a)(Object(D.a)({},this.rawRequest),{instant:{epochSecond:Math.round((new Date).getTime()/1e3),nanoOfSecond:Math.round((new Date).getTime()%1e3)*Math.pow(10,6)},level:t,message:r.message,contextMap:Object(D.a)(Object(D.a)({},this.contextMap),{exception:r.exception?{message:r.message,extendedStackTrace:r.exception.stack}:void 0})}))}),[4,Object(C.a)("deals:elsa:log",Object(N.d)(i,a,s,e.isRetryableError,"deals:elsa:log")(o,{headers:this.headers,method:"POST",body:JSON.stringify({events:[{data:c}]})}))];case 1:return u.sent(),[2]}}))}))},e.prototype.createLogData=function(){return{_cluster:this.cluster,_env:"unknown",_fabric:"production"===z.Development?z.Development:z.Production,_sourceGroup:ee["production"===z.Development?Z.test:Z.prod][this.region],_source:"unknown",_id:"unknown",_time:(new Date).toISOString()}},e.prototype.createRawRequest=function(){return{thread:"unknown",loggerName:"service/elsa/elsaService",endOfBatch:!1,loggerFqcn:"unknown"}},e.prototype.createContextMap=function(){return{currency:this.serviceContext.currencyIsoCode,deviceType:this.serviceContext.deviceType,isInternal:this.serviceContext.isInternal?q.Internal:q.External,locale:this.serviceContext.locale,marketplaceId:this.serviceContext.marketplaceId,pageType:this.renderingContext.pageType,pageTypeID:this.renderingContext.pageId,creativeID:this.renderingContext.creativeId,placementID:this.renderingContext.placementId,remoteAddress:this.serviceContext.clientIpAddress,sessionId:this.serviceContext.sessionId,slotName:this.slot,userAgent:navigator.userAgent,widgetName:this.widgetType,screenWidth:screen.width,screenHeight:screen.height}},e.isRetryableError=function(e){return!(!e||429===e.status||503===e.status)&&e.status>=400},e}(),re=r("ne7G"),ne=r("mxJH"),ae=r("3w8K"),ie=r("88fb");var oe=r("JG2M"),se=r("OXqi"),ce=r.n(se),ue=r("b9ts");function le(e){return a.a.createElement(ue.b,{deviceType:e.deviceType},a.a.createElement(ce.a,{deviceType:e.deviceType,marketplaceId:e.marketplaceId,weblabProvider:{configuredWeblabs:[]},renderFn:function(){return e.children}}))}function de(e){window.Globals=window.Globals||{},e&&!window.Globals.TTIRecorded&&(window.uet("fn"),window.Globals.TTIRecorded=!0)}function fe(e,t,r,n,s){var c=new V(r.serviceContext,r.widgetType,r.renderingContext.pageType,r.renderingContext.pageId,e),l=new b.a(r.serviceContext,n,r.widgetType,r.renderingContext.pageId),d=new S.a(r.serviceContext,r.maxTotalNumberOfDeals,c,l,n,new re.a),f=Object(ne.b)(d,void 0),p=d.getPrefetchedSearchResults(r.prefetchedData);f.dispatch(Object(ne.n)(r.presets,r.initialFilterPresetId,r.initialFilterSelection)),f.dispatch(Object(ae.o)(r.serviceContext,r,e)),f.dispatch(Object(ne.s)(p.availableFilters,!1)),f.dispatch(Object(ne.o)(r.viewPortSize)),f.dispatch(Object(ne.m)(p)),f.dispatch(Object(ne.l)(d.getPrefetchedDeals(r.prefetchedData,p,r.initialLoadTimeUtc,r.viewPortSize,r.initialViewportIndex),r.initialViewportIndex)),r.serviceContext.featureToggles.watchDealsLever||f.dispatch(Object(ne.j)(r.showWatchlist)),s&&h(f),Object(i.render)(a.a.createElement(le,{marketplaceId:r.serviceContext.marketplaceId,deviceType:r.serviceContext.deviceType},a.a.createElement(ie.a.Provider,{value:{marketplaceId:r.serviceContext.marketplaceId,slot:e,widgetType:r.widgetType,showWatchDealAction:r.showWatchDealAction,isRtlLocale:r.serviceContext.isRtlLocale,isWideCharsLocale:r.serviceContext.isWideCharsLocale,isOmnibusMarketplace:r.serviceContext.isOmnibusMarketplace,isSponsoredLabelMarketplace:r.serviceContext.marketplaceId===u.b,currency:Object(oe.a)(r.serviceContext,n),weblabs:r.serviceContext.weblabs,locale:r.serviceContext.locale,isBrowseNodeRendering:r.renderingContext.pageType===u.a}},a.a.createElement(o.a,{store:f},t))),document.querySelector("#"+e+" .deals-react-app"))}if(window.Globals=window.Globals||{},!window.Globals.dealsAssestsInitialized&&(window.Globals.dealsAssestsInitialized=!0,1)){var pe=new f;c.a.setDefaultMetricsProviders([pe]),window.P.register("DealsWidgetsHorizonteAssets",(function(){return{mountWidget:function(e,t){t.serviceContext=u.c,function(e,t,r){var n;t&&(window.Globals.dealsWidgetConfigurations=Object(D.a)(Object(D.a)({},window.Globals.dealsWidgetConfigurations),((n={})[e]=r,n)))}(e,t.serviceContext.isInternal,t);var n=t.widgetType,i=new te(t.serviceContext,t.widgetType,e,t.renderingContext),o=new d(t.serviceContext,i),l=new s.Event("",s.EventType.OPERATIONAL),f=new s.TimerMetric(n+":mount:latency",l);switch(f.startTimer(),n){case p.t.GRID:Promise.all([r.e("styles"),r.e(0),r.e(3),r.e(1),r.e(5)]).then(r.bind(null,"6tFG")).then((function(r){var n=r.default;fe(e,a.a.createElement(n,{widgetConfiguration:t}),t,o,!0),de(t.serviceContext.recordTTI),f.recordTimer(),c.a.record(l)}));break;case p.t.SHOVELER:Promise.all([r.e("styles"),r.e(0),r.e(2),r.e(1),r.e(4)]).then(r.bind(null,"hVU/")).then((function(r){var n=r.default;fe(e,a.a.createElement(n,{widgetConfiguration:t}),t,o),de(t.serviceContext.recordTTI),f.recordTimer(),c.a.record(l)}));break;case p.t.HERO:Promise.all([r.e("styles"),r.e(0),r.e(2),r.e(1),r.e(6)]).then(r.bind(null,"+hqL")).then((function(r){var n=r.default;fe(e,a.a.createElement(n,{widgetConfiguration:t}),t,o),de(t.serviceContext.recordTTI),f.recordTimer(),c.a.record(l)}));break;default:o.logError({message:"unknown widget "+t.widgetType,exception:new Error("unknown widget "+t.widgetType)}),f.stopTimer()}}}}))}},gs7j:function(e,t,r){"use strict";r.d(t,"a",(function(){return te}));var n=r("mrSG"),a=r("kcif"),i=r.n(a),o=r("6soB"),s=r("i7xV"),c=r("uxts"),u=r("aE9G"),l=r("Qjkb"),d=r("SN2E"),f=r("IOG6");function p(e){return Boolean(e.text)||""===e.text}function g(e){return Boolean(e.fragments)}var T,m,E,h=function(){function e(e){this.loggerService=e}return e.prototype.transformImages=function(e,t,r){if(!e.length){var n=new Error("No images provided for deal: "+t);return this.loggerService.logError({exception:n,message:n.message},"deals:errors:aapi:deal:imagesMissing"),{baseUrl:"",extension:""}}var a=e[0];return{baseUrl:"https://"+this.getCdn(r)+"/images/I/"+a.physicalId,extension:a.extension}},e.prototype.transformTime=function(e,t){return this.getRelativeTime(e.value,t)},e.prototype.transformStartTime=function(e,t){var r=this.getRelativeTime(e.value,t),n=new Date(e.value);return{msToStart:r,timeOfStart:{hours:n.getHours(),minutes:n.getMinutes()}}},e.prototype.transformRichContentToMessage=function(e,t,r,n,a){var i=this;if(!g(e)){var o=new Error("Rich content translation issue: "+JSON.stringify(e));return this.loggerService.logError({message:o.message,exception:o},"deals:errors:aapi:deal:richContentUnknownFragment"),[{text:""}]}return e.fragments.map((function(e){if(p(e))return{text:e.text};if(function(e){return Boolean(e.countdownTimer)}(e))return{msLeft:i.getRelativeTime(e.countdownTimer.targetTime,r)};if(function(e){return Boolean(e.dateTime)}(e))return{text:Object(f.b)(new Date(e.dateTime))};if(function(e){var t;return Boolean(null===(t=e.link)||void 0===t?void 0:t.url)}(e))return{url:e.link.url,text:e.link.content.text};if(function(e){return Boolean(e.money)}(e)){var o=a?Math.floor(Number(e.money.amount)):Number(e.money.amount);return n?{price:Object(d.c)(o,t)}:{price:Object(d.b)(o,t)}}var s=new Error("Rich content translation issue: Unknown fragment "+JSON.stringify(e));return i.loggerService.logError({message:s.message,exception:s},"deals:errors:aapi:deal:richContentUnknownFragment"),{text:""}}))},e.prototype.transformFailedResourceReferenceToError=function(e,t){var r={url:e.resource.url,status:e.entity.code,info:e.entity.internalInfo,isPolling:t};return new Error("AAPI resource failure ["+e.resource.types.join(",")+"] - "+JSON.stringify(r))},e.prototype.transformFailedCollectionToError=function(e){return new Error("AAPI resource failure ["+e.resource.types.join(",")+"] - { url: "+e.resource.url+"}")},e.prototype.getCdn=function(e){return"AAHKV2X7AFYLW"===e?"images-cn.ssl-images-amazon.com":"m.media-amazon.com"},e.prototype.getRelativeTime=function(e,t){return new Date(e).getTime()-t},e}(),v=r("JG2M");!function(e){e.BEST_DEAL="BEST_DEAL",e.DEAL_OF_THE_DAY="DEAL_OF_THE_DAY",e.LIGHTNING_DEAL="LIGHTNING_DEAL",e.COUPON_DEAL="COUPON_DEAL",e.UNKNOWN="UNKNOWN"}(T||(T={})),function(e){e.DEAL_OF_THE_DAY="DEAL_OF_THE_DAY",e.PRIME_EARLY_ACCESS="PRIME_EARLY_ACCESS",e.PRIME_EXCLUSIVE="PRIME_EXCLUSIVE",e.UNKNOWN="UNKNOWN"}(m||(m={})),function(e){e.ENERGY_EFFICIENCY="ENERGY_EFFICIENCY",e.ENERGY_GUIDE="ENERGY_GUIDE",e.LIGHTING_FACTS="LIGHTING_FACTS",e.PRODUCT_FICHE="PRODUCT_FICHE",e.UNKNOWN="UNKNOWN"}(E||(E={}));var I,O,b,S,D=function(){function e(e,t,r){this.loggerService=e,this.aapiCommonTransformer=t,this.aapiPriceTransformer=r}return e.prototype.transformDealDetails=function(e,t,r,n,a){var i=Object(v.a)(a,this.loggerService),o=a.isOmnibusMarketplace;return{dealType:this.transformDealType(e.type),itemType:s.i.SINGLE_ITEM,title:e.title,imageUrl:this.aapiCommonTransformer.transformImages(e.images,r,a.marketplaceId),egressUrl:e.landingPage.url,price:this.aapiPriceTransformer.transformPrice(e.price,i,n,o),msToEnd:this.aapiCommonTransformer.transformTime(e.endTime,n),startTime:this.aapiCommonTransformer.transformStartTime(e.startTime,n),transformationTime:Date.now(),isSponsored:!1,label:this.transformDealLabel(t,i,n),messaging:this.transformDealMessaging(t,i,n),energyEfficiencyLabel:this.transformEnergyEfficiency(e.energyEfficiency,a.marketplaceId)}},e.prototype.transformDealType=function(e){if(e===T.UNKNOWN){var t=new Error("Details type is unknown");return this.loggerService.logError({message:t.message,exception:t},"deals:errors:aapi:deal:dealTypeUnknown"),s.f.DEAL_OF_THE_DAY}return s.f[e]},e.prototype.transformDealLabel=function(e,t,r){var a,i,o,c;return void 0===(null===e||void 0===e?void 0:e.label)?null:Object(n.a)({message:this.aapiCommonTransformer.transformRichContentToMessage(null===e||void 0===e?void 0:e.label.content,t,r,!0,"DOWN"===(null===(a=null===e||void 0===e?void 0:e.label)||void 0===a?void 0:a.experimentalRounding)),color:null===(i=null===e||void 0===e?void 0:e.label)||void 0===i?void 0:i.experimentalColor,backgroundColor:null===(o=null===e||void 0===e?void 0:e.label)||void 0===o?void 0:o.experimentalBackgroundColor},(null===(c=null===e||void 0===e?void 0:e.label)||void 0===c?void 0:c.type)?{type:s.j[e.label.type]}:{})},e.prototype.transformDealMessaging=function(e,t,r){var a,i,o;return void 0===(null===e||void 0===e?void 0:e.messaging)?null:Object(n.a)({message:this.aapiCommonTransformer.transformRichContentToMessage(null===e||void 0===e?void 0:e.messaging.content,t,r,!0,!1),color:null===(a=null===e||void 0===e?void 0:e.messaging)||void 0===a?void 0:a.experimentalColor,backgroundColor:null===(i=null===e||void 0===e?void 0:e.messaging)||void 0===i?void 0:i.experimentalBackgroundColor},(null===(o=null===e||void 0===e?void 0:e.messaging)||void 0===o?void 0:o.type)?{type:s.k[e.messaging.type]}:{})},e.prototype.transformEnergyEfficiency=function(e,t){var r,n,a,i,o,s,c,u,l,d,f,p=(null===(n=null===(r=null===e||void 0===e?void 0:e.entity)||void 0===r?void 0:r.experimentalRating)||void 0===n?void 0:n.absoluteRating)&&(null===(i=null===(a=null===e||void 0===e?void 0:e.entity)||void 0===a?void 0:a.experimentalVisual)||void 0===i?void 0:i.length)?e.entity.experimentalRating.absoluteRating:null===(s=null===(o=null===e||void 0===e?void 0:e.entity)||void 0===o?void 0:o.rating)||void 0===s?void 0:s.absoluteRating,g=(null===(u=null===(c=null===e||void 0===e?void 0:e.entity)||void 0===c?void 0:c.experimentalRating)||void 0===u?void 0:u.absoluteRating)&&(null===(d=null===(l=null===e||void 0===e?void 0:e.entity)||void 0===l?void 0:l.experimentalVisual)||void 0===d?void 0:d.length)?e.entity.experimentalVisual:null===(f=null===e||void 0===e?void 0:e.entity)||void 0===f?void 0:f.visual,T=null===g||void 0===g?void 0:g.find((function(e){return e.type===E.ENERGY_EFFICIENCY})),m=null===g||void 0===g?void 0:g.find((function(e){return e.type===E.PRODUCT_FICHE}));return p&&T&&m?{rating:p,energyEfficiencyImage:this.transformEnergyEfficiencyVisual(T,t),productFicheImage:this.transformEnergyEfficiencyVisual(m,t)}:null},e.prototype.transformEnergyEfficiencyVisual=function(e,t){return{url:"https://"+this.aapiCommonTransformer.getCdn(t)+"/images/I/"+e.image.physicalId+"."+e.image.extension,height:e.image.height,width:e.image.width}},e}();!function(e){e.FEATURED="FEATURED",e.TRENDING="TRENDING",e.BY_DISCOUNT_DESCENDING="BY_DISCOUNT_DESCENDING",e.BY_DISCOUNT_ASCENDING="BY_DISCOUNT_ASCENDING",e.BY_PRICE_DESCENDING="BY_PRICE_DESCENDING",e.BY_PRICE_ASCENDING="BY_PRICE_ASCENDING",e.COHORTING="COHORTING",e.RANDOM="RANDOM",e.UNKNOWN="UNKNOWN"}(I||(I={})),function(e){e.QA="QA",e.UNKNOWN="UNKNOWN"}(O||(O={})),function(e){e.PRIME_ONLY="PRIME_ONLY",e.PRIME_EARLY_ACCESS="PRIME_EARLY_ACCESS",e.APP_ONLY="APP_ONLY",e.APP_EARLY_ACCESS="APP_EARLY_ACCESS",e.UNKNOWN="UNKNOWN"}(b||(b={})),function(e){e.UPCOMING="UPCOMING",e.AVAILABLE="AVAILABLE",e.WAITLIST="WAITLIST",e.WAITLISTFULL="WAITLISTFULL",e.EXPIRED="EXPIRED",e.SOLDOUT="SOLDOUT",e.UNKNOWN="SOLDOUT"}(S||(S={}));var R,_,A,y,C=((R={})[s.f.DEAL_OF_THE_DAY]=T.DEAL_OF_THE_DAY,R[s.f.LIGHTNING_DEAL]=T.LIGHTNING_DEAL,R[s.f.BEST_DEAL]=T.BEST_DEAL,R[s.f.COUPON_DEAL]=T.COUPON_DEAL,R[s.f.EVENT_DEAL]=T.UNKNOWN,R),N=((_={})[s.d.AVAILABLE]=S.AVAILABLE,_[s.d.UPCOMING]=S.UPCOMING,_[s.d.EXPIRED]=S.EXPIRED,_[s.d.SOLDOUT]=S.SOLDOUT,_[s.d.WAITLIST]=S.WAITLISTFULL,_[s.d.WAITLISTFULL]=S.WAITLISTFULL,_),L=((A={})[s.e.QA]=O.QA,A),P=((y={})[s.r.BY_SCORE]=I.FEATURED,y[s.r.TRENDING]=I.TRENDING,y[s.r.BY_DISCOUNT_DESCENDING]=I.BY_DISCOUNT_DESCENDING,y[s.r.BY_DISCOUNT_ASCENDING]=I.BY_DISCOUNT_ASCENDING,y[s.r.BY_PRICE_DESCENDING]=I.BY_PRICE_DESCENDING,y[s.r.BY_PRICE_ASCENDING]=I.BY_PRICE_ASCENDING,y[s.r.COHORTING]=I.COHORTING,y[s.r.RANDOM]=I.RANDOM,y),w=function(){function e(){}return e.prototype.buildDealsSearchRequest=function(e,t,r,a){return Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)({},this.buildPaginationToken(300,t)),{pageSize:300}),this.buildFilterBy(e)),this.buildSortOrder(e.sorting)),this.buildPinnedDealGroups(e.dealGroups)),this.buildRankingContext(a,e.rankGroup)),this.buildRefinementsRequired(r))},e.prototype.buildPaginationToken=function(e,t){return"undefined"!==typeof t?{paginationToken:(Math.floor(t/e)*e).toString()}:{}},e.prototype.buildFilterBy=function(e){return e?{filterBy:Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)({},this.buildDealTypes(e.dealTypes)),this.buildDealStates(e.dealStates)),this.buildDepartments(e.departments)),this.buildMinPercentOff(e.discountRanges)),this.buildMaxPercentOff(e.discountRanges)),this.buildMinPrice(e.priceRanges)),this.buildMaxPrice(e.priceRanges)),this.buildMinRating(e.starRatings)),this.buildPrimeEligibleOnly(e.prime.selected)),this.buildIncludedTags(e.marketingTagsIncluded)),this.buildExcludedTags(e.marketingTagsExcluded)),this.buildExpiringWithinInMinutes(e.expiringWithin)),this.buildMinDurationInMinutes(e.minDurationInMinutes)),this.buildMaxTimeSinceLaunchInMinutes(e.maxTimeSinceLaunchInMinutes)),this.buildIncludedRestrictedVisibilityHints(e.exclusiveTarget)),this.buildIncludedAccessBehaviors(e.primeEarlyAccess,e.primeExclusive,e.appOnly))}:{}},e.prototype.buildDealTypes=function(e){var t=e.filter((function(e){return e.selected})).map((function(e){var t=e.dealType;return C[t]}));return t.length?{dealTypes:t}:{dealTypes:e.map((function(e){var t=e.dealType;return C[t]}))}},e.prototype.buildDealStates=function(e){var t=e.filter((function(e){return e.selected})).map((function(e){var t=e.dealState;return N[t]}));return t.length?{dealStates:t}:{dealStates:e.map((function(e){var t=e.dealState;return N[t]}))}},e.prototype.buildDepartments=function(e){var t=e.some((function(e){return e.selected}))?e.filter((function(e){return e.selected})):e.filter((function(e){return e.enforced}));return t.length?{departments:t.map((function(e){return e.id}))}:{}},e.prototype.buildSortOrder=function(e){return e?{sortOrder:P[e]}:{}},e.prototype.buildMinPercentOff=function(e){var t=e.find((function(e){return e.selected}));return t?{minPercentOff:t.from}:{}},e.prototype.buildMaxPercentOff=function(e){var t=e.find((function(e){return e.selected}));return(null===t||void 0===t?void 0:t.to)?{maxPercentOff:t.to}:{}},e.prototype.buildMinPrice=function(e){var t=e.filter((function(e){return e.selected}));return t.length?{minPrice:t[0].from.toString()}:{}},e.prototype.buildMaxPrice=function(e){var t=e.filter((function(e){return e.selected}));return t.length&&t[0].to?{maxPrice:t[0].to.toString()}:{}},e.prototype.buildMinRating=function(e){var t=e.find((function(e){return e.selected}));return t?{minRating:t.stars}:{}},e.prototype.buildExpiringWithinInMinutes=function(e){return e?{expiringWithinInMinutes:e}:{}},e.prototype.buildPrimeEligibleOnly=function(e){return e?{primeEligibleOnly:e}:{}},e.prototype.buildIncludedTags=function(e){return e.length?{includedTags:e}:{}},e.prototype.buildExcludedTags=function(e){return e.length?{excludedTags:e}:{}},e.prototype.buildMinDurationInMinutes=function(e){return e?{minDurationInMinutes:e}:{}},e.prototype.buildMaxTimeSinceLaunchInMinutes=function(e){return e?{maxTimeSinceLaunchInMinutes:e}:{}},e.prototype.buildIncludedRestrictedVisibilityHints=function(e){return e?{includedRestrictedVisibilityHints:[L[e.type]]}:{}},e.prototype.buildIncludedAccessBehaviors=function(e,t,r){var a=Object(n.f)((null===e||void 0===e?void 0:e.selected)?[b.PRIME_EARLY_ACCESS]:[],(null===t||void 0===t?void 0:t.selected)?[b.PRIME_ONLY]:[],(null===r||void 0===r?void 0:r.selected)?[b.APP_ONLY]:[]);return a.length?{includedAccessBehaviors:a}:{}},e.prototype.buildPinnedDealGroups=function(e){return(null===e||void 0===e?void 0:e.length)?{pinnedDealGroups:e}:{}},e.prototype.buildRankingContext=function(e,t){return{rankingContext:{pageTypeId:e,rankGroup:t}}},e.prototype.buildRefinementsRequired=function(e){return{refinementsRequired:e===s.t.GRID}},e}();function j(e){return Boolean(e.priceRanges)}function x(e){return Boolean(e.departments)}function M(e){return Boolean(e.discountRanges)}function F(e){return Boolean(e.primeEligible)}var G=function(){function e(e){this.loggerService=e}return e.prototype.transformDealsSearchResult=function(e,t,r){return{totalCount:r||(null===e||void 0===e?void 0:e.totalCount)||0,availableFilters:this.transformRefinements(null===e||void 0===e?void 0:e.refinements),dealIds:this.transformRankedDeals(null===e||void 0===e?void 0:e.rankedDeals),dealsIdsStartIndex:t||0}},e.prototype.transformRefinements=function(e){return{departments:this.transformDepartments(e),priceRanges:this.transformPriceRanges(e),discounts:this.transformDiscountRanges(e),containsPrimeEligible:this.transformContainsPrimeEligible(e)}},e.prototype.transformDepartments=function(e){var t=this,r=null===e||void 0===e?void 0:e.find((function(e){return x(e)}));return r&&x(r)?r.departments.options.map((function(e){return{sectionText:r.departments.displayText,optionText:t.transformOptionText(e.name),id:e.filter.department}})):[]},e.prototype.transformPriceRanges=function(e){var t=null===e||void 0===e?void 0:e.find((function(e){return j(e)}));return t&&j(t)?t.priceRanges.options.map((function(e){return{sectionText:t.priceRanges.displayText,from:e.filter.minPrice?parseFloat(e.filter.minPrice):0,to:e.filter.maxPrice?parseFloat(e.filter.maxPrice):null}})):[]},e.prototype.transformDiscountRanges=function(e){var t=this,r=null===e||void 0===e?void 0:e.find((function(e){return M(e)}));return r&&M(r)?r.discountRanges.options.map((function(e){return{sectionText:r.discountRanges.displayText,optionText:t.transformOptionText(e.name),from:e.filter.minPercentOff||0,to:e.filter.maxPercentOff||null}})):[]},e.prototype.transformContainsPrimeEligible=function(e){var t=null===e||void 0===e?void 0:e.find((function(e){return F(e)}));return!(!t||!F(t))&&t.primeEligible.options[0].filter.primeEligibleOnly},e.prototype.transformRankedDeals=function(e){return e?e.map((function(e){var t=e.resource.url.split("/");return t[t.length-1]})):[]},e.prototype.transformOptionText=function(e){if(g(e)&&p(e.fragments[0]))return e.fragments[0].text;var t=new Error("Invalid option text for: "+e);return this.loggerService.logError({exception:t,message:t.message},"deals:errors:aapi:dealsSearch:invalidOptionText"),""},e}(),U=function(){function e(){}return e.prototype.transformDealStatus=function(e){var t,r;return{percentClaimed:null===(t=null===e||void 0===e?void 0:e.percentClaimed)||void 0===t?void 0:t.value,state:null===e||void 0===e?void 0:e.state.valueOf(),pollStatusPeriodMs:(null===(r=null===e||void 0===e?void 0:e.metadata)||void 0===r?void 0:r.statusMaxAgeInMilliseconds)||6e5,lastUpdated:(new Date).getTime(),isWatched:!1}},e}(),B=function(){function e(e){this._isPolling=e,this.dealsSuccessCount=0,this.dealsErrorCount=0,this.detailsSuccessCount=0,this.detailsErrorCount=0,this.statusSuccessCount=0,this.statusErrorCount=0,this.badgeSuccessCount=0,this.badgeErrorCount=0}return e.prototype.isPolling=function(){return this._isPolling},e.prototype.incrementDealsSuccessCount=function(){this.dealsSuccessCount++},e.prototype.incrementDetailsSuccessCount=function(){this.detailsSuccessCount++},e.prototype.incrementStatusSuccessCount=function(){this.statusSuccessCount++},e.prototype.incrementBadgeSuccessCount=function(){this.badgeSuccessCount++},e.prototype.incrementDealsErrorCount=function(){this.dealsErrorCount++},e.prototype.incrementDetailsErrorCount=function(){this.detailsErrorCount++},e.prototype.incrementStatusErrorCount=function(){this.statusErrorCount++},e.prototype.incrementBadgeErrorCount=function(){this.badgeErrorCount++},e.prototype.createMetricName=function(e){return this.isPolling()?e.concat(":polling"):e},e.prototype.recordDealsMetrics=function(){Object(o.d)(this.createMetricName("deals:aapi:deal:success"),this.dealsSuccessCount,this.dealsErrorCount+this.dealsSuccessCount),Object(o.d)(this.createMetricName("deals:aapi:deal:details:success"),this.detailsSuccessCount,this.detailsErrorCount+this.detailsSuccessCount),Object(o.d)(this.createMetricName("deals:aapi:deal:status:success"),this.statusSuccessCount,this.statusErrorCount+this.statusSuccessCount),Object(o.d)(this.createMetricName("deals:aapi:deal:badge:success"),this.badgeSuccessCount,this.badgeErrorCount+this.badgeSuccessCount)},e}(),H=function(){function e(e,t,r){this.aapiDealStatusTransformer=e,this.aapiDealDetailsTransformer=t,this.aapiFailureHandler=r}return e.prototype.transformDealCollections=function(e,t,r){var n=this;return e.map((function(e){var a=e.collection,i=e.serverTimeUtc,o=n.aapiFailureHandler.handleFailuresInDealsCollectionResource(a)||[];return n.transformAapiDeals(o,i,t,r)})).flat()},e.prototype.transformAapiDeals=function(e,t,r,n){var a=this;void 0===e&&(e=[]);var i=new B(n),o=e.map((function(e){return a.transformAapiDeal(e,t,r,i)}));return i.recordDealsMetrics(),o},e.prototype.transformAapiDeal=function(e,t,r,n){var a=this.aapiFailureHandler.handleFailuresInDealResource(e,n);if(!a)return{dealID:this.getDealIdFromResource(e),dealRank:0};var i=a.dealId,o=a.details,s=a.status,c=a.badge;return{dealID:i,dealRank:0,dealStatus:this.aapiDealStatusTransformer.transformDealStatus(s),dealDetails:this.aapiDealDetailsTransformer.transformDealDetails(o,c,i,t,r)}},e.prototype.getDealIdFromResource=function(e){var t=e.resource.url.split("/");return t[t.length-1]},e}();function W(e){return 0===e.type.indexOf("error")}var Y=function(){function e(e,t){this.loggerService=e,this.aapiCommonTransformer=t}return e.prototype.handleFailuresInDealResource=function(e,t){var r=this.extractEntityFromResource(e,t,(function(){return t.incrementDealsSuccessCount}),(function(){return t.incrementDealsErrorCount}),"deals:errors:aapi:deal");if(r){var n=this.extractEntityFromResource(r.details,t,(function(){return t.incrementDetailsSuccessCount}),(function(){return t.incrementDetailsErrorCount}),"deals:errors:aapi:deal:details");if(n){var a=this.extractEntityFromResource(r.status,t,(function(){return t.incrementStatusSuccessCount}),(function(){return t.incrementStatusErrorCount}),"deals:errors:aapi:deal:status"),i=this.extractEntityFromResource(r.badge,t,(function(){return t.incrementBadgeSuccessCount}),(function(){return t.incrementBadgeErrorCount}),"deals:errors:aapi:deal:badge");return{dealId:r.id,details:n,status:a,badge:i}}}},e.prototype.handleFailuresInDealsCollectionResource=function(e){if(Object(o.b)("deals:aapi:deal:collection:success",!W(e)),W(e)){if(this.isEntityAbsent(e))return Object(o.c)("deals:aapi:deal:collection:notFound"),void Object(o.e)("deals:fatals:aapi:deal:collection",1);var t=this.aapiCommonTransformer.transformFailedCollectionToError(e);return this.loggerService.logFatal({exception:t,message:t.message}),void Object(o.e)("deals:fatals:aapi:deal:collection",1)}return Object(o.e)("deals:fatals:aapi:deal:collection",0),e.entities},e.prototype.extractEntityFromResource=function(e,t,r,n,a){if(e){if(W(e)){if(this.isEntityAbsent(e))return Object(o.c)(a+":notFound"),void n();var i=this.aapiCommonTransformer.transformFailedResourceReferenceToError(e,t.isPolling());return n(),void this.loggerService.logError({exception:i,message:i.message},a)}return r(),e.entity}},e.prototype.isEntityAbsent=function(e){return!e.entity||(404===e.entity.status||e.entity.code.startsWith("404"))},e}(),k=r("/xOi"),V=function(){function e(e){this.aapiCommonTransformer=e}return e.prototype.transformPrice=function(e,t,r,n){var a;if(!e)return{type:s.p.SUPPRESSED};if(e.message)return{type:s.p.MESSAGE,message:this.aapiCommonTransformer.transformRichContentToMessage(e.message,t,r,!1,!1)};var i=e.details.dealPrice.moneyValueOrRange;return this.isRangePrice(i)?{type:s.p.PRICE_RANGE,minPrice:Object(d.b)(Number(i.range.min.amount),t),maxPrice:Object(d.b)(Number(i.range.max.amount),t)}:{type:s.p.SINGLE_DEAL_PRICE,price:Object(d.b)(Number(i.value.amount),t),strikeThroughPrice:this.translateBasisPrice(t,n,e.details.basisPrice,null===(a=e.details.savings)||void 0===a?void 0:a.percentage.value),unitPrice:this.translateUnitPrice(t,e.details.dealPrice.unitPrice)}},e.prototype.translateBasisPrice=function(e,t,r,n){if(r&&!this.isRangePrice(r.moneyValueOrRange)&&void 0!==n&&(t||0!==n))return{basis:{price:Object(d.b)(Number(r.moneyValueOrRange.value.amount),e),label:r.label?Object(k.b)("deals-label-colon","${label}: ",{label:r.label}):""},percentOff:n}},e.prototype.translateUnitPrice=function(e,t){if(t)return{price:Object(d.b)(Number(t.moneyValue.amount),e),label:t.baseUnit.displayString,baseValue:t.baseValue.displayString}},e.prototype.isRangePrice=function(e){return Boolean(e.range)},e}(),z=function(){function e(){}return e.prototype.transformWatchedDealsResponseFromAapi=function(e){return e.entity.deals.map((function(e){var t;return null!==(t=e.resource.url.split("/").pop())&&void 0!==t?t:""}))},e.prototype.transformWatchDealResponseFromAapi=function(e){var t=!e.type.includes("error");return{isSuccessful:t,error:t?"":"Error, please try again"}},e}(),q='application/vnd.com.amazon.api+json; type="deals.search.result/v1"; expand="rankedDeals[](deal/v1)"; experiments="deals_ranking_context_9pfrvnvbw,deals_ranking_fields_page_type_id_v6tyxms63,deals_ranking_fields_rank_group_jo2isoq03"',K='application/vnd.com.amazon.api+json; type="collection(deal/v1)/v1"; expand="details(deal.details/v1),status(deal.status/v1),badge(deal.badge/v1)"; experiments="DealBadgeColors_4da10b4,DealBadgeRounding_8c426ad,DealLabelType_05035b,DealMessageType_024db1"',X='application/vnd.com.amazon.api+json; type="collection(deal/v1)/v1"; expand="details(deal.details/v1),status(deal.status/v1),badge(deal.badge/v1),details(deal.details/v1).energyEfficiency(product.energy-efficiency/v2)"; experiments="newEnergyEfficiencyRegulation_adh3j34sa,DealBadgeColors_4da10b4,DealBadgeRounding_8c426ad,DealLabelType_05035b,DealMessageType_024db1"',J='application/vnd.com.amazon.api+json; type="deals.watched/v1"; expand="deals[](deal/v1),paging.next(deals.watched/v1),"',Q='application/vnd.com.amazon.api+json; type="deal.watch/v1"',Z='application/vnd.com.amazon.api+json; type="deal.unwatch/v1"',$='application/vnd.com.amazon.api+json; type="deal.watch.request/v1"',ee='application/vnd.com.amazon.api+json; type="deal.unwatch.request/v1"',te=function(){function e(e,t,r,n){this.serviceContext=e,this.loggerService=t,this.widgetType=r,this.pageTypeId=n,this.aapiConsecutiveTokenFailures=0,this.shouldShowEnergyEfficiencyLabel=Object(c.a)(this.serviceContext.marketplaceId),this.aapiCommonTransformer=new h(t),this.aapiDealStatusTransformer=new U,this.aapiPriceTransformer=new V(this.aapiCommonTransformer),this.aapiDealDetailsTransformer=new D(t,this.aapiCommonTransformer,this.aapiPriceTransformer),this.aapiFailuresHandler=new Y(t,this.aapiCommonTransformer),this.aapiDealTransformer=new H(this.aapiDealStatusTransformer,this.aapiDealDetailsTransformer,this.aapiFailuresHandler),this.aapiDealsSearchRequestTransformer=new w,this.aapiDealsSearchResponseTransformer=new G(t),this.aapiWatchDealTransformer=new z}return e.prototype.searchDeals=function(e,t){return Object(n.b)(this,void 0,void 0,(function(){var r;return Object(n.d)(this,(function(n){switch(n.label){case 0:return[4,this.searchDealsReference(e,t)];case 1:return r=n.sent(),[2,this.aapiDealsSearchResponseTransformer.transformDealsSearchResult(r.entity,t)]}}))}))},e.prototype.searchDealsReference=function(t,r){return Object(n.b)(this,void 0,void 0,(function(){var a,i,s,c,l,d,f;return Object(n.d)(this,(function(n){switch(n.label){case 0:return a=this.serviceContext.services.aapi,i=a.maxRetries,s=a.retryTimoutInMs,c=a.uri,l=a.enableRetries,d=this.buildDealsSearchParams(t,r),f=c+"/api/marketplaces/"+this.serviceContext.marketplaceId+"/deals?"+d,[4,Object(o.a)("deals:aapi:dealsSearch",Object(u.c)({method:"GET",credentials:"include",headers:this.getAAPIHeaders(q,void 0,!0),apiName:"deals:aapi:dealsSearch",requestUri:f,maxRetries:i,retryTimoutInMs:s,enableRetries:l,isRetryableError:e.isRetryableErrorAAPI}))];case 1:return[2,n.sent().data]}}))}))},e.prototype.transformDealsSearchResult=function(e,t,r){return this.aapiDealsSearchResponseTransformer.transformDealsSearchResult(e,t,r)},e.prototype.getDealsBatchFromAAPI=function(t){return Object(n.b)(this,void 0,void 0,(function(){var r,a,i,s,c,l,d,f;return Object(n.d)(this,(function(n){switch(n.label){case 0:r=this.serviceContext.services.aapi,a=r.maxRetries,i=r.retryTimoutInMs,s=r.uri,c=r.enableRetries,l=s+"/api/marketplaces/"+this.serviceContext.marketplaceId+"/deals/"+t.join(","),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Object(o.a)("deals:aapi:getDeals:batch",Object(u.c)({method:"GET",credentials:"include",headers:this.getAAPIHeaders(this.shouldShowEnergyEfficiencyLabel?X:K,void 0,!0),apiName:"deals:aapi:getDeals:batch",requestUri:l,maxRetries:a,retryTimoutInMs:i,enableRetries:c,isRetryableError:e.isRetryableErrorAAPI}))];case 2:return d=n.sent(),this.aapiConsecutiveTokenFailures=0,[3,4];case 3:throw(f=n.sent())instanceof u.b&&404===f.status&&(this.aapiConsecutiveTokenFailures++,this.aapiConsecutiveTokenFailures>=20&&window.location.reload()),f;case 4:return[2,{collection:d.data,serverTimeUtc:this.getServerTime(d)}]}}))}))},e.prototype.getWatchedDeals=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,r,a,i,s,c,l;return Object(n.d)(this,(function(n){switch(n.label){case 0:return t=this.serviceContext.services.aapi,r=t.maxRetries,a=t.retryTimoutInMs,i=t.uri,s=t.enableRetries,c=i+"/api/marketplaces/"+this.serviceContext.marketplaceId+"/deals/watched",[4,Object(o.a)("deals:aapi:getWatchedDeals",Object(u.c)({method:"GET",credentials:"include",headers:this.getAAPIHeaders(J),apiName:"deals:aapi:getWatchedDeals",requestUri:c,maxRetries:r,retryTimoutInMs:a,enableRetries:s,isRetryableError:e.isRetryableErrorAAPI}))];case 1:return l=n.sent(),[2,this.aapiWatchDealTransformer.transformWatchedDealsResponseFromAapi(l.data)]}}))}))},e.prototype.getDealsByIdsFromAAPI=function(e,t){return Object(n.b)(this,void 0,void 0,(function(){var r,a,s=this;return Object(n.d)(this,(function(n){switch(n.label){case 0:return r=i()(e,30),[4,Object(o.a)("deals:aapi:getDeals",Promise.all(r.map((function(e){return s.getDealsBatchFromAAPI(e)}))))];case 1:return a=n.sent(),[2,this.transformDealCollections(a,t)]}}))}))},e.prototype.transformDealCollections=function(e,t){return this.aapiDealTransformer.transformDealCollections(e,this.serviceContext,t)},e.prototype.setWatchedDealStatus=function(t,r){return Object(n.b)(this,void 0,void 0,(function(){var a,i,c,l,d,f,p;return Object(n.d)(this,(function(n){switch(n.label){case 0:return a=this.serviceContext.services.aapi,i=a.maxRetries,c=a.retryTimoutInMs,l=a.uri,d=a.enableRetries,f=l+"/api/marketplaces/"+this.serviceContext.marketplaceId+"/deals/"+t+"/watch",[4,Object(o.a)("deals:aapi:setWatchedDealStatus",Object(u.c)({method:r===s.s.REMOVE?"DELETE":"POST",credentials:"include",body:"{}",headers:r===s.s.REMOVE?this.getAAPIHeaders(Z,ee):this.getAAPIHeaders(Q,$),apiName:"deals:aapi:setWatchedDealStatus",requestUri:f,maxRetries:i,retryTimoutInMs:c,enableRetries:d,isRetryableError:e.isRetryableErrorAAPI}))];case 1:return p=n.sent(),[2,this.aapiWatchDealTransformer.transformWatchDealResponseFromAapi(p.data)]}}))}))},e.prototype.getAAPIHeaders=function(t,r,a){var i=Object(n.a)({"Content-Type":r||"application/json","Accept-Language":e.getAcceptLanguage(this.serviceContext.locale),Accept:t,"x-api-csrf-token":this.serviceContext.aapiCsrfToken},Object(l.a)());return a?Object(n.a)(Object(n.a)({},i),{"x-cc-currency-of-preference":this.serviceContext.currencyIsoCode}):i},e.isNotRetryableStatus=function(e){return 429===e||503===e},e.getAcceptLanguage=function(e){return String(e).replace("_","-")},e.prototype.getServerTime=function(e){var t=e.headers.get("Date");if(Object(o.b)("deals:aapi:deal:serverTime:success",null!==t&&""!==t),null===t||""===t){var r=new Error("Server time is not provided by AAPI :"+JSON.stringify(e));return this.loggerService.logError({exception:r,message:r.message},"deals:errors:aapi:deal:serverTimeMissing"),(new Date).getTime()}return new Date(t).getTime()},e.isRetryableErrorAAPI=function(t){return!(!t||e.isNotRetryableStatus(t.status))&&t.status>=400},e.prototype.buildDealsSearchParams=function(e,t){var r=this.aapiDealsSearchRequestTransformer.buildDealsSearchRequest(e,t,this.widgetType,this.pageTypeId),n=new URLSearchParams;return r.paginationToken&&n.append("paginationToken",t.toString()),r.pageSize&&n.append("pageSize",r.pageSize.toString()),r.filterBy&&n.append("filterBy",JSON.stringify(r.filterBy)),r.sortOrder&&n.append("sortOrder",r.sortOrder),r.pinnedDealGroups&&n.append("pinnedDealGroups",JSON.stringify(r.pinnedDealGroups)),r.rankingContext&&n.append("rankingContext",JSON.stringify(r.rankingContext)),r.refinementsRequired&&n.append("refinementsRequired","true"),n.toString()},e}()},i7xV:function(e,t,r){"use strict";var n,a,i,o,s,c,u,l,d,f,p,g;function T(e){return Boolean(e.dealDetails&&e.dealStatus)}function m(e){var t,r=e.dealDetails,n=e.dealStatus;return(r.dealType===i.LIGHTNING_DEAL||r.dealType===i.DEAL_OF_THE_DAY)&&r.msToEnd>0&&(null===(t=r.startTime)||void 0===t?void 0:t.msToStart)<=0&&void 0!==n.percentClaimed}function E(e){return e.dealStatus.state===o.UPCOMING&&(e.dealDetails.dealType===i.LIGHTNING_DEAL||e.dealDetails.dealType===i.DEAL_OF_THE_DAY||e.dealDetails.dealType===i.BEST_DEAL)}r.d(t,"i",(function(){return a})),r.d(t,"f",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return s})),r.d(t,"v",(function(){return T})),r.d(t,"u",(function(){return m})),r.d(t,"w",(function(){return E})),r.d(t,"p",(function(){return u})),r.d(t,"k",(function(){return d})),r.d(t,"j",(function(){return f})),r.d(t,"o",(function(){return p})),r.d(t,"h",(function(){return g})),r.d(t,"m",(function(){return v})),r.d(t,"a",(function(){return I})),r.d(t,"l",(function(){return O})),r.d(t,"q",(function(){return b})),r.d(t,"r",(function(){return h})),r.d(t,"b",(function(){return y})),r.d(t,"B",(function(){return C})),r.d(t,"g",(function(){return S})),r.d(t,"c",(function(){return D})),r.d(t,"n",(function(){return R})),r.d(t,"s",(function(){return _})),r.d(t,"z",(function(){return N})),r.d(t,"A",(function(){return L})),r.d(t,"x",(function(){return P})),r.d(t,"y",(function(){return w})),r.d(t,"t",(function(){return A})),function(e){e.PRIME_ONLY_LD="PRIME_ONLY_LD",e.PRIME_ONLY_DOTD="PRIME_ONLY_DOTD",e.PRIME_ONLY_BD="PRIME_ONLY_BD",e.PRIME_EARLY_ACCESS="PRIME_EARLY_ACCESS",e.APP_ONLY_LD="APP_ONLY_LD",e.APP_EARLY_ACCESS="APP_EARLY_ACCESS"}(n||(n={})),function(e){e.NONE="NONE",e.SINGLE_ITEM="SINGLE_ITEM",e.MULTI_ITEM="MULTI_ITEM",e.VARIATION_ITEM="VARIATION_ITEM"}(a||(a={})),function(e){e.DEAL_OF_THE_DAY="DEAL_OF_THE_DAY",e.LIGHTNING_DEAL="LIGHTNING_DEAL",e.BEST_DEAL="BEST_DEAL",e.EVENT_DEAL="EVENT_DEAL",e.COUPON_DEAL="COUPON_DEAL"}(i||(i={})),function(e){e.AVAILABLE="AVAILABLE",e.UPCOMING="UPCOMING",e.WAITLIST="WAITLIST",e.WAITLISTFULL="WAITLISTFULL",e.SOLDOUT="SOLDOUT",e.EXPIRED="EXPIRED"}(o||(o={})),function(e){e.QA="QA"}(s||(s={})),function(e){e.ListPrice="LP",e.OurPrice="OP",e.PreviousPublishedPrice="PPP",e.UVPListPrice="ULP",e.OriginalEditionPrice="OEP",e.RetailPreviousPrice="RPP",e.SeparatePurchaseListPrice="SPLP",e.PrintListPrice="PLP",e.DigitalListPrice="DLP"}(c||(c={})),function(e){e.SINGLE_DEAL_PRICE="SINGLE_DEAL_PRICE",e.UP_TO_PERCENT_OFF="UP_TO_PERCENT_OFF",e.DEAL_PRICE_AND_UNDER="DEAL_PRICE_AND_UNDER",e.MARKETING_MESSAGE="MARKETING_MESSAGE",e.SUPPRESSED="SUPPRESSED",e.PRICE_RANGE="PRICE_RANGE",e.MESSAGE="MESSAGE"}(u||(u={})),function(e){e.DEAL_OF_THE_DAY="DEAL_OF_THE_DAY",e.PRIME_EARLY_ACCESS="PRIME_EARLY_ACCESS",e.PRIME_ONLY="PRIME_ONLY",e.APP_ONLY="APP_ONLY",e.PRIME_DAY="PRIME_DAY",e.JUPITER="JUPITER",e.DOUBLE_11="DOUBLE_11",e.BLACK_FRIDAY="BLACK_FRIDAY",e.CYBER_MONDAY="CYBER_MONDAY",e.LAST_MINUTES="LAST_MINUTES",e.BOXING_DAY="BOXING_DAY",e.BUEN_FIN="BUEN_FIN",e.HVE1="HVE1",e.HVE2="HVE2"}(l||(l={})),function(e){e.UPCOMING_DEAL_STARTS_IN_DAYS="UPCOMING_DEAL_STARTS_IN_DAYS",e.UPCOMING_DEAL_STARTS_AT_HOURS="UPCOMING_DEAL_STARTS_AT_HOURS",e.UPCOMING_DEAL_STARTS_IN_MINUTES="UPCOMING_DEAL_STARTS_IN_MINUTES",e.UPCOMING_PRIME_EXCLUSIVE="UPCOMING_PRIME_EXCLUSIVE",e.LIVE_PRIME_EXCLUSIVE_DEAL="LIVE_PRIME_EXCLUSIVE_DEAL",e.LIVE_PRIME_EARLY_ACCESS_DEAL="LIVE_PRIME_EARLY_ACCESS_DEAL",e.LIVE_ENDS_IN_DEAL="LIVE_ENDS_IN_DEAL",e.LIVE_DEFAULT_DEAL="LIVE_DEFAULT_DEAL",e.LIVE_TOP_DEAL="LIVE_TOP_DEAL",e.LIVE_HVE_DEAL="LIVE_HVE_DEAL",e.COUPON="COUPON",e.APP_EXCLUSIVE_DEAL="APP_EXCLUSIVE_DEAL",e.UNKNOWN="UNKNOWN"}(d||(d={})),function(e){e.LIVE_SINGLE_ASIN="LIVE_SINGLE_ASIN",e.LIVE_SINGLE_ASIN_HIGH_ASP="LIVE_SINGLE_ASIN_HIGH_ASP",e.LIVE_MULTIPLE_ASIN="LIVE_MULTIPLE_ASIN",e.LIVE_MULTIPLE_ASIN_HIGH_ASP="LIVE_MULTIPLE_ASIN_HIGH_ASP",e.LIVE_MULTIPLE_ASIN_HIGH_ASP_SAME_PRICE="LIVE_MULTIPLE_ASIN_HIGH_ASP_SAME_PRICE",e.LIVE_MULTIPLE_ASIN_LOW_ASP="LIVE_MULTIPLE_ASIN_LOW_ASP",e.LIVE_MULTIPLE_ASIN_LOW_ASP_SAME_PRICE="LIVE_MULTIPLE_ASIN_LOW_ASP_SAME_PRICE",e.LIVE_UNDEFINED="LIVE_UNDEFINED",e.UPCOMING_PRIME_EARLY_ACCESS_DEAL="UPCOMING_PRIME_EARLY_ACCESS_DEAL",e.UPCOMING_DEAL="UPCOMING_DEAL",e.UNKNOWN="UNKNOWN"}(f||(f={})),function(e){e.FILTER="filter",e.WATCHLIST="watchlist",e.REDIRECT="redirect"}(p||(p={})),function(e){e.ALL="ALL",e.PRIME="PRIME",e.DEPARTMENTS="DEPARTMENTS",e.DEAL_TYPE="DEAL_TYPE",e.AVAILABILITY="AVAILABILITY",e.PRICE="PRICE",e.DISCOUNT="DISCOUNT",e.REVIEWS="REVIEWS",e.PRESETS="PRESETS",e.SORTING="SORTING"}(g||(g={}));var h,v=null,I=null,O=void 0,b=!0;!function(e){e.BY_SCORE="BY_SCORE",e.BY_DISCOUNT_ASCENDING="BY_DISCOUNT_ASCENDING",e.BY_DISCOUNT_DESCENDING="BY_DISCOUNT_DESCENDING",e.BY_PRICE_ASCENDING="BY_PRICE_ASCENDING",e.BY_PRICE_DESCENDING="BY_PRICE_DESCENDING",e.BY_BEST_SELLING="BY_BEST_SELLING",e.TRENDING="TRENDING",e.COHORTING="COHORTING",e.RANDOM="RANDOM",e.BY_CUSTOM_CRITERION="BY_CUSTOM_CRITERION"}(h||(h={}));var S,D,R,_,A,y=h.BY_SCORE,C=[h.BY_SCORE,h.BY_DISCOUNT_ASCENDING,h.BY_DISCOUNT_DESCENDING,h.BY_PRICE_ASCENDING,h.BY_PRICE_DESCENDING];function N(e){return Boolean(e.text)}function L(e){return Boolean(e.msLeft)}function P(e){return Boolean(e.url)}function w(e){return Boolean(e.price)}!function(e){e.MOBILE="mobile",e.TABLET="tablet",e.DESKTOP="desktop",e.FIREPHONE="firephone"}(S||(S={})),function(e){e.TITLE="TITLE",e.IMG="IMG",e.STAR_RATING="STAR_RATING",e.ADD_TO_CART="ADD_TO_CART",e.WAIT_LIST="WAIT_LIST",e.WATCH="WATCH",e.UNWATCH="UNWATCH",e.COLLECT_VOUCHERS="COLLECT_VOUCHERS",e.VIEW_ALL_ITEMS="VIEW_ALL_ITEMS",e.LEARN_MORE="LEARN_MORE",e.VIEW_DETAILS="VIEW_DETAILS",e.SIGN_UP_FOR_PRIME="SIGN_UP_FOR_PRIME",e.VIEW_OPTIONS="VIEW_OPTIONS"}(D||(D={})),function(e){e.GRID_PRESETS_CAROUSEL="GRID_PRESETS_CAROUSEL",e.DEALS_SHOVELER="DEALS_SHOVELER",e.GRID_PAGINATION="GRID_PAGINATION",e.DEALS_HERO_SHOVELER="DEALS_HERO_SHOVELER"}(R||(R={})),function(e){e.ADD="ADD",e.REMOVE="REMOVE"}(_||(_={})),function(e){e.HERO="deals-hero",e.SHOVELER="deals-shoveler",e.GRID="deals-grid"}(A||(A={}))},mZCz:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,a=r("mrSG"),i=r("6soB");function o(e,t){var r=Object(a.f)(["deals"],t.attribution||[]).join(":"),n=t.exception,i=Object(a.e)(t,["exception"]);window.ueLogError&&n&&window.ueLogError(n,Object(a.a)(Object(a.a)({logLevel:e},i),{attribution:r}))}!function(e){e.FATAL="FATAL",e.ERROR="ERROR",e.WARN="WARN",e.INFO="INFO"}(n||(n={})),t.b={fatal:function(e){o(n.FATAL,e)},error:function(e,t){o(n.ERROR,e),t&&Object(i.c)(t)},warn:function(e){o(n.WARN,e)}}},mxJH:function(e,t,r){"use strict";r.d(t,"n",(function(){return z})),r.d(t,"i",(function(){return K})),r.d(t,"r",(function(){return X})),r.d(t,"s",(function(){return $})),r.d(t,"g",(function(){return re})),r.d(t,"o",(function(){return p})),r.d(t,"m",(function(){return g})),r.d(t,"a",(function(){return m})),r.d(t,"f",(function(){return h})),r.d(t,"h",(function(){return O})),r.d(t,"c",(function(){return b})),r.d(t,"e",(function(){return _})),r.d(t,"l",(function(){return y})),r.d(t,"q",(function(){return N})),r.d(t,"j",(function(){return ie})),r.d(t,"d",(function(){return oe})),r.d(t,"k",(function(){return se})),r.d(t,"p",(function(){return ue})),r.d(t,"b",(function(){return Ee}));var n=r("ANjH"),a=r("sINF"),i=r("mrSG"),o=r("/MKj"),s=r("sEfC"),c=r.n(s),u=r("6soB"),l=r("i7xV"),d=r("LGkc"),f=r("aE9G"),p=function(e){return{viewportSize:e,type:D}},g=function(e){var t=e.dealIds,r=e.sponsoredDealsMetadata,n=e.totalCount,a=e.viewportDeals;return{type:R,dealIds:t,sponsoredDealsMetadata:r,totalCount:n,viewportDeals:a}};function T(e,t,r){var n=Math.max(0,t),a=n+Math.max(0,r);return e.slice(n,a)}var m=function(){return function(e,t,r){return e(_()),E(e,r,t)||Promise.resolve()}},E=c()((function(e,t,r){return Object(i.b)(void 0,void 0,void 0,(function(){var n,a,s,c,l,d,p,m,E,h,I,O,b,S;return Object(i.d)(this,(function(D){switch(D.label){case 0:n=r(),a=n.deals,s=n.filters,c=a.dealsIds,l=a.viewportSize,d=a.totalCount,p=a.sponsoredDealsMetadata,m=a.index,m+=l,D.label=1;case 1:return D.trys.push([1,5,,6]),j(c,m,l,d)?(E=e,h=g,I=[{}],[4,x(t,c,m,l,s.filterSelection,p)]):[3,3];case 2:E.apply(void 0,[h.apply(void 0,[i.a.apply(void 0,[i.a.apply(void 0,I.concat([D.sent()])),{viewportDeals:a.viewportDeals}])])]),D.label=3;case 3:return O=T(r().deals.dealsIds,m,l),[4,t.getDealsByIds(O)];case 4:return b=D.sent(),Object(o.b)((function(){e(y(Object(i.f)(a.viewportDeals,b),m)),e(N(r().watchedDeals.watchedDealIds))})),Object(u.e)(v,0),[3,6];case 5:return S=D.sent(),Object(f.e)(S)?S instanceof f.b&&t.logError({message:"Loading deals failed on server side at index "+m,exception:S}):(t.logFatal({message:"Loading deals failed on client side at at index "+m,exception:S}),Object(u.e)(v,1)),e(A()),[3,6];case 6:return[2]}}))}))}),300,{leading:!0,trailing:!0}),h=function(e){return function(t,r,n){return t(_()),I(t,n,r,e)||Promise.resolve()}},v="deals:fatals:getDealsByIds:failedToLoad",I=c()((function(e,t,r,n){return Object(i.b)(void 0,void 0,void 0,(function(){var a,s,c,l,d,p,m,E,h,I,O,b,S;return Object(i.d)(this,(function(D){switch(D.label){case 0:a=r(),s=a.deals,c=a.filters,l=s.dealsIds,d=s.viewportSize,p=s.totalCount,m=s.sponsoredDealsMetadata,D.label=1;case 1:return D.trys.push([1,5,,6]),j(l,n,d,p)?(E=e,h=g,I=[{}],[4,x(t,l,n,d,c.filterSelection,m)]):[3,3];case 2:E.apply(void 0,[h.apply(void 0,[i.a.apply(void 0,[i.a.apply(void 0,I.concat([D.sent()])),{viewportDeals:s.viewportDeals}])])]),D.label=3;case 3:return O=T(r().deals.dealsIds,n,d),[4,t.getDealsByIds(O)];case 4:return b=D.sent(),Object(o.b)((function(){e(y(b,n)),e(N(r().watchedDeals.watchedDealIds))})),Object(u.e)(v,0),[3,6];case 5:return S=D.sent(),Object(f.e)(S)?S instanceof f.b&&t.logError({message:"Loading deals failed on server side at index "+n,exception:S}):(t.logFatal({message:"Loading deals failed on client side at at index "+n,exception:S}),Object(u.e)(v,1)),e(A()),[3,6];case 6:return[2]}}))}))}),300,{leading:!0,trailing:!0});function O(){return function(e,t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(s=t().deals.viewportDeals,c=Date.now(),0===(n=s.filter((function(e){if(!Object(l.v)(e))return!0;var t=c-e.dealStatus.lastUpdated;return t>=e.dealStatus.pollStatusPeriodMs||t<0})).map((function(e){return e.dealID}))).length)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.getDealsByIds(n,!0)];case 2:return a=i.sent(),e(C(a)),e(N(t().watchedDeals.watchedDealIds)),Object(u.e)("deals:fatals:failedToRefresh",0),[3,4];case 3:if(o=i.sent(),Object(f.e)(o)){if(o instanceof f.b&&(r.logError({message:"Refreshing deals failed on server side "+JSON.stringify(n),exception:o}),d.a.isNotRetryableStatus(o.status)))throw new f.a(o.message)}else r.logFatal({message:"Refreshing deals failed on client side "+JSON.stringify(n),exception:o}),Object(u.e)("deals:fatals:failedToRefresh",1);return e(A()),[3,4];case 4:return[2]}var s,c}))}))}}function b(e){return e.map((function(e){return Object(l.v)(e)?""+e.dealID+e.dealStatus.lastUpdated:""+e.dealID+Date.now()})).join("")}var S={dealsIds:[],sponsoredDealsMetadata:{},totalCount:0,index:0,viewportSize:60,viewportDeals:[],isLoading:!1},D="STORE_VIEWPORT_SIZE",R="STORE_DEAL_IDS",_=function(){return{type:"LOAD_DEALS_START"}},A=function(){return{type:"LOAD_DEALS_FAILED"}},y=function(e,t){return{type:"SET_VIEWPORT_STATE",index:t,viewportDeals:e}},C=function(e){return{type:"REPLACE_STALE_DEALS",refreshedDeals:e}},N=function(e){return{type:"UPDATE_DEALS_WATCHED_STATE",watchedDealIds:e}};function L(e,t){var r=e;return t.map((function(e){return Object(i.a)(Object(i.a)({},e),{dealRank:r++})}))}function P(e,t){return t.map((function(t){return Object(l.v)(t)?Object(i.a)(Object(i.a)({},t),{dealDetails:Object(i.a)(Object(i.a)({},t.dealDetails),{isSponsored:Boolean(null===e||void 0===e?void 0:e[t.dealID]),sponsoredUrl:null===e||void 0===e?void 0:e[t.dealID]})}):t}))}function w(e,t){return e.map((function(e){if(!Object(l.v)(e))return e;var r=t.includes(e.dealID);return r&&!e.dealStatus.isWatched||!r&&e.dealStatus.isWatched?Object(i.a)(Object(i.a)({},e),{dealStatus:Object(i.a)(Object(i.a)({},e.dealStatus),{isWatched:r})}):e}))}function j(e,t,r,n){for(var a=Math.min(t+r,n)-1,i=t;i<=a;i++)if(!e[i])return!0;return!1}function x(e,t,r,n,a,o){return Object(i.b)(this,void 0,void 0,(function(){var s,c,u,l,d,f;return Object(i.d)(this,(function(p){switch(p.label){case 0:return[4,e.searchDeals(a,M(n,r,t.length))];case 1:return s=p.sent(),c=s.dealsIdsStartIndex,u=s.dealIds,l=s.totalCount,d=s.sponsoredDealsMetadata,(f=new Array(Math.max(t.length,c+u.length))).splice.apply(f,Object(i.f)([0,f.length],t)),f.splice.apply(f,Object(i.f)([c,u.length],u)),[2,{dealIds:f,sponsoredDealsMetadata:Object(i.a)(Object(i.a)({},o),d),totalCount:l}]}}))}))}function M(e,t,r){return t<r&&t+e>r?r:t}var F=r("3w8K"),G=r("mZCz");function U(e,t,r){return void 0===r&&(r=!1),Object(i.a)(Object(i.a)({},e),{departments:B(e.departments,t.departments),priceRanges:H((a=e.priceRanges,a.find((function(e){return e.selected}))),t.priceRanges,r),discountRanges:W((n=e.discountRanges,n.find((function(e){return e.selected}))),t.discounts,r)});var n,a}function B(e,t){for(var r=[],n=function(n){var a=t.find((function(t){return e[n].id===t.id}));r.push(Object(i.a)(Object(i.a)({},e[n]),{sectionText:(null===a||void 0===a?void 0:a.sectionText)?a.sectionText:e[n].sectionText,optionText:(null===a||void 0===a?void 0:a.optionText)?a.optionText:e[n].optionText,hasItems:!!a}))},a=0;a<e.length;++a)n(a);return r}function H(e,t,r){return void 0===r&&(r=!1),r&&!t.length&&e?[e]:t.map((function(t){return{sectionText:t.sectionText,from:t.from,to:t.to,selected:!!e&&(e.from===t.from&&e.to===t.to)}}))}function W(e,t,r){return void 0===r&&(r=!1),r&&!t.length&&e?[e]:t.map((function(t){return{sectionText:t.sectionText,optionText:t.optionText,from:t.from,to:t.to,selected:!!e&&e.from===t.from}}))}var Y=r("ijCd"),k=r.n(Y);function V(e,t){if(t===l.l)return e.selected;var r=t.find((function(t){return e.id===t.id}));return r?r.selected:e.selected}var z=function(e,t,r){var n=e.find((function(e){return e.presetId===t&&e.type===l.o.FILTER}))||null;if(!n){var a=new Error("Storing presets failed: "+JSON.stringify(e,null,2));throw G.b.fatal({message:a.message,exception:a}),Object(u.e)("deals:fatals:filters:initialPresetNotFound",1),a}return Object(u.e)("deals:fatals:filters:initialPresetNotFound",0),{filterPresets:e,initialFilterPreset:n,initialFilterSelection:r,type:Q}},q=function(e){return{preset:e,type:Z}},K=function(e,t){return function(r,n,a){return Object(i.b)(this,void 0,void 0,(function(){var o,s,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:r(q(e)),i.label=1;case 1:return i.trys.push([1,4,,5]),o=n().filters.filterSelection,[4,a.searchDeals(o,0)];case 2:return s=i.sent(),r(oe()),r($(s.availableFilters,t)),r(g(s)),[4,r(h(0))];case 3:return i.sent(),r(te()),Object(u.e)("deals:fatals:filters:presetSelectionFailed",0),[3,5];case 4:return c=i.sent(),Object(f.e)(c)?c instanceof f.b&&a.logError({message:"Preset selection failed on server side: "+JSON.stringify(e,null,2),exception:c}):(a.logFatal({message:"Preset selection failed on client side: "+JSON.stringify(e,null,2),exception:c}),Object(u.e)("deals:fatals:filters:presetSelectionFailed",1)),[3,5];case 5:return[2]}}))}))}};var X=function(e,t){return void 0===t&&(t=!1),function(r,n,a){return Object(i.b)(this,void 0,void 0,(function(){var o,s,c,d;return Object(i.d)(this,(function(p){switch(p.label){case 0:o=function(e,t){var r,n,a;if(e.sorting===l.r.BY_SCORE)return Object(i.a)(Object(i.a)({},e),{sorting:(null===(a=null===(n=null===(r=t.currentPreset)||void 0===r?void 0:r.attributes)||void 0===n?void 0:n.filterSelection)||void 0===a?void 0:a.sorting)||l.r.BY_SCORE});return e}(e,n().filters),r(ee(o)),p.label=1;case 1:return p.trys.push([1,4,,5]),s=n().filters.filterSelection,"undefined"!==typeof(T=e.preset)&&Object.prototype.hasOwnProperty.call(T,"filterSelection")&&r(q(e.preset)),[4,a.searchDeals(s,0)];case 2:return c=p.sent(),r(oe()),r($(c.availableFilters,t)),r(g(c)),[4,r(h(0))];case 3:return p.sent(),r(te()),r(Object(F.l)({filterUpdate:o})),Object(u.e)("deals:fatals:filters:updateFailed",0),[3,5];case 4:return d=p.sent(),Object(f.e)(d)?d instanceof f.b&&a.logError({message:"Filter updating failed on server side: "+JSON.stringify(o,null,2),exception:d}):(a.logFatal({message:"Filter updating failed on client side: "+JSON.stringify(o,null,2),exception:d}),Object(u.e)("deals:fatals:filters:updateFailed",1)),[3,5];case 5:return[2]}var T}))}))}};var J={filterPresets:[],currentPreset:{},filterSelection:{marketingTagsIncluded:[],marketingTagsExcluded:[],departments:[],priceRanges:[],discountRanges:[],prime:{selected:!1},primeEarlyAccess:{selected:!1,isVisible:!0},primeExclusive:{selected:!1,isVisible:!0},appOnly:{selected:!1},dealStates:[],dealTypes:[],starRatings:[],dealGroups:[],dealIdsIncluded:[],dealIdsExcluded:[],expiringWithin:0,sorting:l.r.TRENDING,rankGroup:"",geoSearchQueryTerms:[]},isLoading:!1,openBottomSheet:null},Q="STORE_PRESETS",Z="SELECT_PRESET",$=function(e,t){return{type:"UPDATE_FILTER_HAS_ITEMS",availableFilters:e,keepSelectedFilter:t}},ee=function(e){return{type:"UPDATE_FILTER",filterUpdate:e}},te=function(){return{type:"UPDATE_FILTER_SUCCESS"}},re=function(e){return{type:"OPEN_BOTTOM_SHEET",toOpen:e}};var ne=r("UQr2"),ae=r("/xOi");var ie=function(e){return function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(r){switch(r.label){case 0:return e?(t(_()),[4,t(ce())]):[3,3];case 1:return r.sent(),[4,t(se())];case 2:return r.sent(),[3,5];case 3:return[4,t(ce())];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}},oe=function(){return{type:Te,active:!1}},se=function(){return function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r;return Object(i.d)(this,(function(n){switch(n.label){case 0:return ne.c.featureToggles.watchDealsLever?[4,e(ce())]:[3,2];case 1:n.sent(),n.label=2;case 2:return r=t().watchedDeals.watchedDealIds,e(g({dealIds:r,sponsoredDealsMetadata:{},totalCount:r.length})),e({type:Te,active:!0}),[4,e(h(0))];case 3:return n.sent(),[2]}}))}))}},ce=function(){return function(e,t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.getCustomerId()?[4,r.fetchWatchlist()]:[2];case 1:return n=i.sent(),e({type:fe,watchedDealIds:n}),e(N(t().watchedDeals.watchedDealIds)),Object(u.e)("deals:fatals:watchedDeals:watchedDealIds:failedToLoad",0),[3,3];case 2:return a=i.sent(),Object(f.e)(a)?a instanceof f.b&&r.logError({message:"Fetching watchedDealIds failed on sever side",exception:a}):(r.logFatal({message:"Fetching watchedDealIds failed on client side",exception:a}),Object(u.e)("deals:fatals:watchedDeals:watchedDealIds:failedToLoad",1)),[3,3];case 3:return[2]}}))}))}},ue=function(e){return function(t,r,n){return Object(i.b)(this,void 0,void 0,(function(){var a,o,s,c,u,d;return Object(i.d)(this,(function(p){switch(p.label){case 0:a=e.dealID,o=e.dealRank,s=e.dealStatus.percentClaimed,p.label=1;case 1:return p.trys.push([1,3,,4]),n.getCustomerId()?(c=r().watchedDeals.watchedDealIds.includes(a),[4,le(n,c,a)]):[2,new Promise((function(){return n.loginAndRedirect()}))];case 2:return(u=p.sent()).isSuccessful&&(d=c?{type:ge,watchedDealId:a}:function(e){return{type:pe,watchedDealId:e}}(a),t(d),t(N(r().watchedDeals.watchedDealIds)),!c&&n.isApplication()&&function(e){Object(i.b)(this,void 0,void 0,(function(){var t,r;return Object(i.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.subscribeToNotifications()];case 1:if(!(t=n.sent()).isSubscribed)throw new Error(t.error);return[3,3];case 2:return r=n.sent(),Object(f.e)(r)?r instanceof f.b&&e.logError({message:"Register for notifications failed",exception:r}):e.logError({message:"Subscribing to notifications failed",exception:r}),[3,3];case 3:return[2]}}))}))}(n),t(Object(F.k)({dealID:a,dealRank:o,percentClaimed:s,source:c?l.c.UNWATCH:l.c.WATCH}))),[2,u];case 3:return p.sent(),[2,{isSuccessful:!1,error:Object(ae.b)("deals-watch-deal-error","Error, please try again")}];case 4:return[2]}}))}))}};function le(e,t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t?e.unwatchDeal(r):e.watchDeal(r)];case 1:return n=i.sent(),Object(u.e)("deals:fatals:watchedDeals:watchStatus:update",0),[2,n];case 2:return a=i.sent(),Object(f.e)(a)?a instanceof f.b&&e.logError({message:"Updating a watch status of deal with id: "+r+" failed on server side",exception:a}):(e.logFatal({message:"Updating a watch status of deal with id: "+r+" failed on client side",exception:a}),Object(u.e)("deals:fatals:watchedDeals:watchStatus:update",1)),[2,{isSuccessful:!1,error:Object(ae.b)("deals-watch-deal-error","Error, please try again")}];case 3:return[2]}}))}))}var de={watchedDealIds:[],isWatchlistActive:!1},fe="STORE_WATCHLIST_DEAL_IDS",pe="ADD_DEAL_TO_WATCHLIST",ge="REMOVE_DEAL_FROM_WATCHLIST",Te="SET_WATCHLIST_ACTIVATE_STATE";var me=Object(n.c)({deals:function(e,t){switch(void 0===e&&(e=S),t.type){case D:return Object(i.a)(Object(i.a)({},e),{viewportSize:t.viewportSize});case R:return Object(i.a)(Object(i.a)({},e),{dealsIds:t.dealIds,sponsoredDealsMetadata:t.sponsoredDealsMetadata,totalCount:t.totalCount,viewportDeals:(null===t||void 0===t?void 0:t.viewportDeals)?t.viewportDeals:[]});case"LOAD_DEALS_START":return Object(i.a)(Object(i.a)({},e),{isLoading:!0});case"LOAD_DEALS_FAILED":return Object(i.a)(Object(i.a)({},e),{isLoading:!1});case"SET_VIEWPORT_STATE":return Object(i.a)(Object(i.a)({},e),{isLoading:!1,index:t.index,viewportDeals:P(e.sponsoredDealsMetadata,L(e.index,(o=e.dealsIds,s=t.viewportDeals,s.sort((function(e,t){return o.indexOf(e.dealID)-o.indexOf(t.dealID)})))))});case"REPLACE_STALE_DEALS":return Object(i.a)(Object(i.a)({},e),{viewportDeals:P(e.sponsoredDealsMetadata,L(e.index,(r=e.viewportDeals,n=t.refreshedDeals,a=n.reduce((function(e,t){return e[t.dealID]=t,e}),{}),r.map((function(e){return a[e.dealID]||e})))))});case"UPDATE_DEALS_WATCHED_STATE":return Object(i.a)(Object(i.a)({},e),{viewportDeals:w(e.viewportDeals,t.watchedDealIds)});default:return e}var r,n,a,o,s},filters:function(e,t){switch(void 0===e&&(e=J),t.type){case Q:return Object(i.a)(Object(i.a)({},e),{isLoading:!1,filterPresets:t.filterPresets,currentPreset:t.initialFilterPreset,filterSelection:t.initialFilterSelection});case Z:return Object(i.a)(Object(i.a)({},e),{isLoading:!0,currentPreset:t.preset,filterSelection:(C=e.filterSelection,N=t.preset.attributes.filterSelection,L=C.departments.reduce((function(e,t){return e[t.id]=t,e}),{}),Object(i.a)(Object(i.a)({},N),{departments:N.departments.map((function(e){var t,r=null===(t=L[e.id])||void 0===t?void 0:t.hasItems;return r=null===r||r,Object(i.a)(Object(i.a)({},e),{hasItems:r})}))}))});case"UPDATE_FILTER":var r=Object(i.a)(Object(i.a)({},e),{isLoading:!0,filterSelection:(A=e.filterSelection,y=t.filterUpdate,Object(i.a)(Object(i.a)({},A),{departments:(R=A.departments,_=y.departments,_===l.l?R:_===l.q?R.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:e.hasItems})})):R.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:_!==l.a&&V(e,_)})}))),priceRanges:(S=A.priceRanges,D=y.priceRange,D===l.l?S:S.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:D!==l.a&&e.from===D.from&&e.to===D.to})}))),discountRanges:(O=A.discountRanges,b=y.discount,b===l.l?O:O.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:b!==l.a&&e.from===b.from})}))),prime:(v=A.prime,I=y.prime,I===l.l?v:Object(i.a)(Object(i.a)({},v),{selected:I})),primeEarlyAccess:(E=A.primeEarlyAccess,h=y.primeEarlyAccess,h===l.l?E:Object(i.a)(Object(i.a)({},E),{selected:h})),primeExclusive:(T=A.primeExclusive,m=y.primeExclusive,m===l.l?T:Object(i.a)(Object(i.a)({},T),{selected:m})),appOnly:(p=A.appOnly,g=y.appOnly,g===l.l?p:Object(i.a)(Object(i.a)({},p),{selected:g})),dealStates:(d=A.dealStates,f=y.dealStates,f===l.l?d:d.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:f!==l.a&&k()(f,e.dealState)})}))),dealTypes:(c=A.dealTypes,u=y.dealTypes,u===l.l?c:c.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:u!==l.a&&k()(u,e.dealType)})}))),starRatings:(o=A.starRatings,s=y.starRating,s===l.l?o:o.map((function(e){return Object(i.a)(Object(i.a)({},e),{selected:s!==l.a&&e.stars===s})}))),sorting:(n=A.sorting,a=y.sorting,a===l.l?n:a===l.a?l.b:a)}))});return t.filterUpdate.preset&&(r.currentPreset=t.filterUpdate.preset),r;case"UPDATE_FILTER_HAS_ITEMS":return Object(i.a)(Object(i.a)({},e),{filterSelection:U(e.filterSelection,t.availableFilters,t.keepSelectedFilter)});case"UPDATE_FILTER_FAILED":case"UPDATE_FILTER_SUCCESS":return Object(i.a)(Object(i.a)({},e),{isLoading:!1});case"OPEN_BOTTOM_SHEET":return Object(i.a)(Object(i.a)({},e),{openBottomSheet:t.toOpen});default:return e}var n,a,o,s,c,u,d,f,p,g,T,m,E,h,v,I,O,b,S,D,R,_,A,y,C,N,L},events:F.e,watchedDeals:function(e,t){switch(void 0===e&&(e=de),t.type){case fe:return Object(i.a)(Object(i.a)({},e),{watchedDealIds:t.watchedDealIds});case pe:return Object(i.a)(Object(i.a)({},e),{watchedDealIds:Object(i.f)(e.watchedDealIds,[t.watchedDealId])});case ge:return Object(i.a)(Object(i.a)({},e),{watchedDealIds:e.watchedDealIds.filter((function(e){return e!==t.watchedDealId}))});case Te:return Object(i.a)(Object(i.a)({},e),{isWatchlistActive:t.active});default:return e}}});function Ee(e,t){return Object(n.d)(me,n.a.apply(void 0,function(e,t){0;return[a.a.withExtraArgument(e)]}(e)))}},ne7G:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(){function e(){}return e.prototype.loginAndRedirect=function(){var e=new URL("/gp/sign-in.html",location.origin);e.searchParams.append("useRedirectOnSuccess","1");var t=new URL(location.href),r=t.pathname,n=t.search;e.searchParams.append("path",r),e.searchParams.append("query",n),window.location.href=e.href},e}()},uxts:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=new Set(["A1PA6795UKMFR9"]);function a(e){return n.has(e)}}},[["buYj","runtime","styles","vendor"]]]);
//# sourceMappingURL=static/js/static/js/main-fa988312d374d5da43bb.chunk.js.map.js